# ุงูููุฎุต 

ุงูููุฎุต ูู ุฅูุดุงุก ูุณุฎุฉ ุฃูุตุฑ ูู ุงููุณุชูุฏ ุฃู ุงูููุงู ุงูุฐู ููุฎุต ุฌููุน ุงููุนูููุงุช ุงููููุฉ. ุฅูู ุฌุงูุจ ุงูุชุฑุฌูุฉุ ูุนุฏ ุงูููุฎุต ูุซุงููุง ุขุฎุฑ ุนูู ุงูููุงู ุงูุชู ูููู ุตูุงุบุชูุง ููููุฉ ุชุณูุณู ุฅูู ุชุณูุณู. ูููู ุฃู ูููู ุงูููุฎุต:

- ุงุณุชุฎุฑุงุฌู: ุงุณุชุฎุฑุงุฌ ุฃูู ุงููุนูููุงุช ูู ุงููุณุชูุฏ.
- ุชูุฎูุตู: ุฅูุดุงุก ูุต ุฌุฏูุฏ ููุฎุต ุฃูู ุงููุนูููุงุช.

ุณููุถุญ ูุฐุง ุงูุฏููู ููููุฉ:

1. ุถุจุท ูููุฐุฌ T5 ุนูู ูุฌููุนุฉ ูุฑุนูุฉ ูู ููุงุชูุฑ ููุงูุฉ ูุงููููุฑููุง ูู ูุฌููุนุฉ ุจูุงูุงุช BillSum ููููุฎุต ุงูุชูุฎูุตู.
2. ุงุณุชุฎุฏุงู ูููุฐุฌู ุงููุถุจูุท ููุชูุจุค.

ูุจู ุฃู ุชุจุฏุฃุ ุชุฃูุฏ ูู ุชุซุจูุช ุฌููุน ุงูููุชุจุงุช ุงูุถุฑูุฑูุฉ:

```bash
pip install transformers datasets evaluate rouge_score
```

ูุญู ูุดุฌุนู ุนูู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจ Hugging Face ุญุชู ุชุชููู ูู ุชุญููู ูููุฐุฌู ููุดุงุฑูุชู ูุน ุงููุฌุชูุน. ุนูุฏูุง ููุทูุจ ููู ุฐููุ ุฃุฏุฎู ุฑูุฒู ููุชุณุฌูู:

```py
>>> ูู huggingface_hub ุงุณุชูุฑุงุฏ notebook_login

>>> notebook_login()
```
ุจุงูุชุฃููุฏุ ุณุฃููู ุจุชุฑุฌูุฉ ุงููุต ุงูููุฌูุฏ ูู ุงูููุฑุงุช ูุงูุนูุงููู ููุท ูุน ุงุชุจุงุน ุงูุชุนูููุงุช ุงูุชู ูุฏูุชูุง.

## ุชุญููู ูุฌููุนุฉ ุจูุงูุงุช BillSum

ุงุจุฏุฃ ุจุชุญููู ุงูุฌุฒุก ุงููุฑุนู ุงูุฃุตุบุฑ ูู ูุฌููุนุฉ ุจูุงูุงุช BillSum ูููุชุฑุญุงุช ููุงูุฉ ูุงููููุฑููุง ูู ููุชุจุฉ Datasets:

## ุงููุนุงูุฌุฉ ุงููุณุจูุฉ

ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชุญููู ูุญุฏุฏ ุฑููุฒ T5 ููุนุงูุฌุฉ ุงููุต ูุงูููุฎุต:

ูุธููุฉ ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ุงูุชู ุชุฑูุฏ ุฅูุดุงุฆูุง ุชุญุชุงุฌ ุฅูู:

1. ุฅุถุงูุฉ ุจุงุฏุฆุฉ ุฅูู ุงูุฅุฏุฎุงู ูุน ุนุจุงุฑุฉ "summarize: " ุญุชู ูุนุฑู T5 ุฃู ูุฐู ูููุฉ ุชูุฎูุต. ุจุนุถ ุงูููุงุฐุฌ ุงููุงุฏุฑุฉ ุนูู ููุงู NLP ูุชุนุฏุฏุฉ ุชุชุทูุจ ุฅุนุทุงุก ุฅุดุงุฑุฉ ููููุงู ุงููุญุฏุฏุฉ.
2. ุงุณุชุฎุฏุงู ูุณูุท "text_target" ุนูุฏ ุชุญุฏูุฏ ุฑููุฒ ุงูููุตูุงุช.
3. ุงูุทุน ุงูุชุณูุณูุงุช ุจุญูุซ ูุง ุชููู ุฃุทูู ูู ุงูุทูู ุงูุฃูุตู ุงููุญุฏุฏ ุจูุงุณุทุฉ ูุนููุฉ "max_length".

ูุชุทุจูู ูุธููุฉ ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ุนูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุงุ ุงุณุชุฎุฏู ุทุฑููุฉ Dataset.map. ููููู ุชุณุฑูุน ูุธููุฉ "map" ุนู ุทุฑูู ุชุนููู "batched=True" ููุนุงูุฌุฉ ุนูุงุตุฑ ูุชุนุฏุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูู ููุช ูุงุญุฏ:

ุงูุขูุ ูู ุจุฅูุดุงุก ุฏูุนุฉ ูู ุงูุฃูุซูุฉ ุจุงุณุชุฎุฏุงู DataCollatorForSeq2Seq. ูู ุงูุฃูุซุฑ ููุงุกุฉ *ุงูุชูุณูู ุงูุฏููุงูููู* ููุฌูู ุฅูู ุงูุทูู ุงูุฃุทูู ูู ุฏูุนุฉ ุฃุซูุงุก ุงูุฌูุนุ ุจุฏูุงู ูู ุชูุณูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุง ุฅูู ุงูุทูู ุงูุฃูุตู.
## ุงูุชูููู

ุบุงูุจูุง ูุง ูููู ุชุถููู ูููุงุณ ุฃุซูุงุก ุงูุชุฏุฑูุจ ูููุฏูุง ูุชูููู ุฃุฏุงุก ุงููููุฐุฌ ุงูุฎุงุต ุจู. ููููู ุชุญููู ุทุฑููุฉ ุชูููู ุจุณุฑุนุฉ ุจุงุณุชุฎุฏุงู ููุชุจุฉ [Evaluate](https://huggingface.co/docs/evaluate/index) ูู ๐ค . ุจุงููุณุจุฉ ููุฐู ุงููููุฉุ ูู ุจุชุญููู ูููุงุณ [ROUGE](https://huggingface.co/spaces/evaluate-metric/rouge) (ุฑุงุฌุน ุฌููุฉ ๐ค Evaluate [ุงูุณุฑูุนุฉ](https://huggingface.co/docs/evaluate/a_quick_tour) ููุนุฑูุฉ ุงููุฒูุฏ ุญูู ููููุฉ ุชุญููู ูุญุณุงุจ ูููุงุณ):

```python
>>> import evaluate

>>> rouge = evaluate.load("rouge")
```

ุซู ูู ุจุฅูุดุงุก ุฏุงูุฉ ุชูุฑุฑ ุชูุจุคุงุชู ูุชุตูููุงุชู ุฅูู [`~evaluate.EvaluationModule.compute`] ูุญุณุงุจ ูููุงุณ ROUGE:

```python
>>> import numpy as np

>>> def compute_metrics(eval_pred):
    predictions, labels = eval_pred
    decoded_preds = tokenizer.batch_decode(predictions, skip_special_tokens=True)
    labels = np.where(labels != -100, labels, tokenizer.pad_token_id)
    decoded_labels = tokenizer.batch_decode(labels, skip_special_tokens=True)

    result = rouge.compute(predictions=decoded_preds, references=decoded_labels, use_stemmer=True)

    prediction_lens = [np.count_nonzero(pred != tokenizer.pad_token_id) for pred in predictions]
    result["gen_len"] = np.mean(prediction_lens)

    return {k: round(v, 4) for k, v in result.items()}
```

ุงูุขูุ ุฏุงูุฉ `compute_metrics` ุงูุฎุงุตุฉ ุจู ุฌุงูุฒุฉ ููุนููุ ูุณุชุนูุฏ ุฅูููุง ุนูุฏ ุฅุนุฏุงุฏ ุงูุชุฏุฑูุจ ุงูุฎุงุต ุจู.

## ุชุฏุฑูุจ

<frameworkcontent>

<pt>

<Tip>

ุฅุฐุง ูู ุชูู ุนูู ุฏุฑุงูุฉ ุจุชุนุฏูู ูููุฐุฌ ุจุงุณุชุฎุฏุงู [`Trainer`]ุ ูุฑุงุฌุน ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุงูุฃุณุงุณู [ููุง](../training#train-with-pytorch-trainer)ย!

</Tip>

ุฃูุช ุงูุขู ุนูู ุงุณุชุนุฏุงุฏ ูุจุฏุก ุชุฏุฑูุจ ูููุฐุฌู! ูู ุจุชุญููู T5 ุจุงุณุชุฎุฏุงู [`AutoModelForSeq2SeqLM`]:

```python
>>> from transformers import AutoModelForSeq2SeqLM, Seq2SeqTrainingArguments, Seq2SeqTrainer

>>> model = AutoModelForSeq2SeqLM.from_pretrained(checkpoint)
```

ูู ูุฐู ุงููุฑุญูุฉุ ูู ูุชุจู ุณูู ุซูุงุซ ุฎุทูุงุช:

1. ุญุฏุฏ ูุฑุท ูุนููุงุช ุงูุชุฏุฑูุจ ุงูุฎุงุตุฉ ุจู ูู [`Seq2SeqTrainingArguments`]. ุงููุนููุฉ ุงููุทููุจุฉ ุงููุญูุฏุฉ ูู `output_dir` ุงูุชู ุชุญุฏุฏ ููุงู ุญูุธ ูููุฐุฌู. ุณูู ุชููู ุจุฏูุน ูุฐุง ุงููููุฐุฌ ุฅูู ุงููุญูุฑ ุนู ุทุฑูู ุชุนููู `push_to_hub=True` (ูุฌุจ ุฃู ุชููู ูุณุฌูุงู ุงูุฏุฎูู ุฅูู Hugging Face ูุชุญููู ูููุฐุฌู). ูู ููุงูุฉ ูู ุญูุจุฉุ ุณูููู [`Trainer`] ุจุชูููู ูููุงุณ ROUGE ูุญูุธ ููุทุฉ ุชูุชูุด ุงูุชุฏุฑูุจ.

2. ูู ุจุชูุฑูุฑ ูุณุงุฆุท ุงูุชุฏุฑูุจ ุฅูู [`Seq2SeqTrainer`] ุฅูู ุฌุงูุจ ุงููููุฐุฌ ููุฌููุนุฉ ุงูุจูุงูุงุช ูุงููุญูู ุงููุบูู ููุฌูุน ุงูุจูุงูุงุช ููุธููุฉ `compute_metrics`.

3. ุงุณุชุฏุนุงุก [`~Trainer.train`] ูุชุนุฏูู ูููุฐุฌู.

```python
>>> training_args = Seq2SeqTrainingArguments(
    output_dir="my_awesome_billsum_model",
    eval_strategy="epoch",
    learning_rate=2e-5,
    per_device_train_batch_size=16,
    per_device_eval_batch_size=16,
    weight_decay=0.01,
    save_total_limit=3,
    num_train_epochs=4,
    predict_with_generate=True,
    fp16=True,
    push_to_hub=True,
)

>>> trainer = Seq2SeqTrainer(
    model=model,
    args=training_args,
    train_dataset=tokenized_billsum["train"],
    eval_dataset=tokenized_billsum["test"],
    tokenizer=tokenizer,
    data_collator=data_collator,
    compute_metrics=compute_metrics,
)

>>> trainer.train()
```

ุจูุฌุฑุฏ ุงูุชูุงู ุงูุชุฏุฑูุจุ ุดุงุฑู ูููุฐุฌู ุนูู ุงููุญูุฑ ุจุงุณุชุฎุฏุงู ุทุฑููุฉ [`~transformers.Trainer.push_to_hub`] ุญุชู ูุชููู ุงูุฌููุน ูู ุงุณุชุฎุฏุงู ูููุฐุฌู:

```python
>>> trainer.push_to_hub()
```

</pt>

<tf>

<Tip>

ุฅุฐุง ูู ุชูู ุนูู ุฏุฑุงูุฉ ุจุชุนุฏูู ูููุฐุฌ ุจุงุณุชุฎุฏุงู Kerasุ ูุฑุงุฌุน ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุงูุฃุณุงุณู [ููุง](../training#train-a-tensorflow-model-with-keras)ย!

</Tip>

ูุชุนุฏูู ูููุฐุฌ ูู TensorFlowุ ุงุจุฏุฃ ุจุฅุนุฏุงุฏ ุฏุงูุฉ ูุญุณู ููุนุฏู ุชุนูู ูุฌุฏูู ุฒููู ูุจุนุถ ูุฑุท ูุนููุงุช ุงูุชุฏุฑูุจ:

```python
>>> from transformers import create_optimizer, AdamWeightDecay

>>> optimizer = AdamWeightDecay(learning_rate=2e-5, weight_decay_rate=0.01)
```

ุจุนุฏ ุฐููุ ููููู ุชุญููู T5 ุจุงุณุชุฎุฏุงู [`TFAutoModelForSeq2SeqLM`]:

```python
>>> from transformers import TFAutoModelForSeq2SeqLM

>>> model = TFAutoModelForSeq2SeqLM.from_pretrained(checkpoint)
```

ูู ุจุชุญููู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู ุฅูู ุชูุณูู `tf.data.Dataset` ุจุงุณุชุฎุฏุงู [`~transformers.TFPreTrainedModel.prepare_tf_dataset`]:

```python
>>> tf_train_set = model.prepare_tf_dataset(
    tokenized_billsum["train"],
    shuffle=True,
    batch_size=16,
    collate_fn=data_collator,
)

>>> tf_test_set = model.prepare_tf_dataset(
    tokenized_billsum["test"],
    shuffle=False,
    batch_size=16,
    collate_fn=data_collator,
)
```

ูู ุจุชูููู ุงููููุฐุฌ ููุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู [`compile`](https://keras.io/api/models/model_training_apis/#compile-method). ูุงุญุธ ุฃู ุฌููุน ููุงุฐุฌ Transformers ุชุญุชูู ุนูู ุฏุงูุฉ ุฎุณุงุฑุฉ ุฐุงุช ุตูุฉ ุจุงููููุฉ ุจุดูู ุงูุชุฑุงุถูุ ูุฐูู ูุง ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูุงุญุฏุฉ ูุง ูู ุชูู ุชุฑูุฏ ุฐูู:

```python
>>> import tensorflow as tf

>>> model.compile(optimizer=optimizer) # ูุง ุชูุฌุฏ ูุณูุทุฉ ุฏุงูุฉ ุงูุฎุณุงุฑุฉ!
```

ุงูุฃูุฑุงู ุงูุฃุฎูุฑุงู ุงููุฐุงู ูุฌุจ ุฅุนุฏุงุฏููุง ูุจู ุจุฏุก ุงูุชุฏุฑูุจ ููุง ุญุณุงุจ ุฏุฑุฌุฉ ROUGE ูู ุงูุชูุจุคุงุชุ ูุชูููุฑ ุทุฑููุฉ ูุฏูุน ูููุฐุฌู ุฅูู ุงููุญูุฑ. ูุชู ุชูููุฐ ููุงููุง ุจุงุณุชุฎุฏุงู [Keras callbacks](../main_classes/keras_callbacks).

ูุฑุฑ ุฏุงูุฉ `compute_metrics` ุงูุฎุงุตุฉ ุจู ุฅูู [`~transformers.KerasMetricCallback`]:

```python
>>> from transformers.keras_callbacks import KerasMetricCallback

>>> metric_callback = KerasMetricCallback(metric_fn=compute_metrics, eval_dataset=tf_validation_set)
```

ุญุฏุฏ ููุงู ุฏูุน ูููุฐุฌู ููุญููู ุงููุบูู ูู [`~transformers.PushToHubCallback`]:

```python
>>> from transformers.keras_callbacks import PushToHubCallback

>>> push_to_hub_callback = PushToHubCallback(
    output_dir="my_awesome_billsum_model",
    tokenizer=tokenizer,
)
```

ุจุนุฏ ุฐููุ ูู ุจุชุฌููุน ุงุณุชุฏุนุงุกุงุชู ูุฑุฉ ุฃุฎุฑู:

```python
>>> callbacks = [metric_callback, push_to_hub_callback]
```

ุฃุฎูุฑูุงุ ุฃูุช ุงูุขู ุนูู ุงุณุชุนุฏุงุฏ ูุจุฏุก ุชุฏุฑูุจ ูููุฐุฌู! ุงุณุชุฏุนุงุก [`fit`](https://keras.io/api/models/model_training_apis/#fit-method) ูุน ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุชุฏุฑูุจูุฉ ูุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุชุ ูุนุฏุฏ ุงูุนุตูุฑุ ูุงุณุชุฏุนุงุกุงุชู ูุชุนุฏูู ุงููููุฐุฌ:

```python
>>> model.fit(x=tf_train_set, validation_data=tf_test_set, epochs=3, callbacks=callbacks)
```

ุจูุฌุฑุฏ ุงูุชูุงู ุงูุชุฏุฑูุจุ ูุชู ุชุญููู ูููุฐุฌู ุชููุงุฆููุง ุฅูู ุงููุญูุฑ ุญุชู ูุชููู ุงูุฌููุน ูู ุงุณุชุฎุฏุงูู!

</tf>

</frameworkcontent>

<Tip>

ููุญุตูู ุนูู ูุซุงู ุฃูุซุฑ ุชูุตููุงู ุญูู ููููุฉ ุชุนุฏูู ูููุฐุฌ ููุชูุฎูุตุ ุฑุงุฌุน ุงูุฏูุชุฑ ุงูููุงุณุจ
[ุฏูุชุฑ ููุงุญุธุงุช PyTorch](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/summarization.ipynb)
ุฃู [ุฏูุชุฑ ููุงุญุธุงุช TensorFlow](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/summarization-tf.ipynb).

</Tip>
## ุงูุงุณุชูุชุงุฌ
ุฑุงุฆุนุ ุงูุขู ุจุนุฏ ุฃู ุถุจุทุช ูููุฐุฌูุ ููููู ุงุณุชุฎุฏุงูู ููุงุณุชูุชุงุฌ!

ูู ุจุงุจุชูุงุฑ ุจุนุถ ุงููุตูุต ุงูุชู ุชุฑุบุจ ูู ุชูุฎูุตูุง. ุจุงููุณุจุฉ ูู T5ุ ูุฌุจ ุฃู ุชููู ุจุฅุถุงูุฉ ุจุงุฏุฆุฉ ุฅูู ูุฏุฎูุงุชู ุจูุงุกู ุนูู ุงููููุฉ ุงูุชู ุชุนูู ุนูููุง. ุจุงููุณุจุฉ ููุชูุฎูุตุ ูุฌุจ ุฃู ุชููู ุจุฅุถุงูุฉ ุจุงุฏุฆุฉ ุฅูู ูุฏุฎูุงุชู ููุง ูู ููุถุญ ุฃุฏูุงู:

ูููู ุงุณุชุฎุฏุงู ูููุฐุฌู ุงููุถุจูุท ููุงุณุชูุชุงุฌ ูู ุจุงุณุชุฎุฏุงูู ูู ["pipeline"]. ูู ุจุชูููุฐ ุนูููุฉ ุชูุฎูุต ุจุงุณุชุฎุฏุงู ูููุฐุฌูุ ููุฑุฑ ุงููุต ุฅููู:

ููููู ุฃูุถูุง ูุญุงูุงุฉ ูุชุงุฆุฌ "pipeline" ูุฏูููุง ุฅุฐุง ุฃุฑุฏุช:

ูู ุจุฑูุฌุฉ ุงููุต ูุงุณุชุฑุฌุงุน "input_ids" ููุตูููุงุช PyTorch:

ุงุณุชุฎุฏู ุทุฑููุฉ ["~generation.GenerationMixin.generate"] ูุฅูุดุงุก ุงูุชูุฎูุต. ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ุงุณุชุฑุงุชูุฌูุงุช ุชูููุฏ ุงููุตูุต ุงููุฎุชููุฉ ูุงููุนููุงุช ููุชุญูู ูู ุงูุชูููุฏุ ุฑุงุฌุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจุชูููุฏ ุงููุตูุต [Text Generation](../main_classes/text_generation).

ูู ุจูู ุชุดููุฑ ุฑููุฒ ุงูุนูุงูุงุช ุงููููุฏุฉ ูุฑุฉ ุฃุฎุฑู ุฅูู ูุต:

ูู ุจุฑูุฌุฉ ุงููุต ูุงุณุชุฑุฌุงุน "input_ids" ููุตูููุงุช TensorFlow:

ุงุณุชุฎุฏู ุทุฑููุฉ ["~transformers.generation_tf_utils.TFGenerationMixin.generate"] ูุฅูุดุงุก ุงูุชูุฎูุต. ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ุงุณุชุฑุงุชูุฌูุงุช ุชูููุฏ ุงููุตูุต ุงููุฎุชููุฉ ูุงููุนููุงุช ููุชุญูู ูู ุงูุชูููุฏุ ุฑุงุฌุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฎุงุตุฉ ุจุชูููุฏ ุงููุตูุต [Text Generation](../main_classes/text_generation).

ูู ุจูู ุชุดููุฑ ุฑููุฒ ุงูุนูุงูุงุช ุงููููุฏุฉ ูุฑุฉ ุฃุฎุฑู ุฅูู ูุต: