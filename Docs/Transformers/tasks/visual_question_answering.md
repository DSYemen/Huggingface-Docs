## ุงูุฅุฌุงุจุฉ ุงูุจุตุฑูุฉ 

[[open-in-colab]] 

ุงูุฅุฌุงุจุฉ ุงูุจุตุฑูุฉ ุนูู ุงูุฃุณุฆูุฉ (VQA) ูู ูููุฉ ุงูุฅุฌุงุจุฉ ุนูู ุฃุณุฆูุฉ ููุชูุญุฉ ุจูุงุกู ุนูู ุตูุฑุฉ. ูุนุงุฏุฉ ูุง ูููู ุงููุฏุฎู ูููุงุฐุฌ ุฏุนู ูุฐู ุงููููุฉ ูุฒูุฌูุง ูู ุตูุฑุฉ ูุณุคุงูุ ูุงููุฎุฑุฌ ูู ุฅุฌุงุจุฉ ูุนุจุฑ ุนููุง ุจุงููุบุฉ ุงูุทุจูุนูุฉ. 

ููููุง ููู ุจุนุถ ุฃูุซูุฉ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงูุฌุฏูุฑุฉ ุจุงูููุงุญุธุฉ ูู VQA: 

- ุชุทุจููุงุช ุงููุตูู ููุณุงุนุฏุฉ ุงูุฃูุฑุงุฏ ุถุนุงู ุงูุจุตุฑ. 
- ุงูุชุนููู: ุทุฑุญ ุฃุณุฆูุฉ ุญูู ุงูููุงุฏ ุงููุฑุฆูุฉ ุงูููุฏูุฉ ูู ุงููุญุงุถุฑุงุช ุฃู ุงููุชุจ ุงููุฏุฑุณูุฉ. ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู VQA ูู ุงููุนุงุฑุถ ุงูุชูุงุนููุฉ ูู ุงููุชุงุญู ุฃู ุงูููุงูุน ุงูุชุงุฑูุฎูุฉ. 
- ุฎุฏูุฉ ุงูุนููุงุก ูุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ: ูููู ูู VQA ุชุนุฒูุฒ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูู ุฎูุงู ุงูุณูุงุญ ูููุณุชุฎุฏููู ุจุทุฑุญ ุฃุณุฆูุฉ ุญูู ุงูููุชุฌุงุช. 
- ุงุณุชุฑุฌุงุน ุงูุตูุฑ: ูููู ุงุณุชุฎุฏุงู ููุงุฐุฌ VQA ูุงุณุชุฑุฌุงุน ุงูุตูุฑ ุฐุงุช ุงูุฎุตุงุฆุต ุงููุญุฏุฏุฉ. ุนูู ุณุจูู ุงููุซุงูุ ูููู ูููุณุชุฎุฏู ุฃู ูุณุฃู "ูู ููุงู ููุจุ" ููุนุซูุฑ ุนูู ุฌููุน ุงูุตูุฑ ุงูุชู ุชุญุชูู ุนูู ููุงุจ ูู ูุฌููุนุฉ ูู ุงูุตูุฑ. 

ูู ูุฐุง ุงูุฏูููุ ุณุชุชุนูู ููููุฉ: 

- ุถุจุท ูููุฐุฌ VQA ููุชุตูููุ ูุชุญุฏูุฏูุง [ViLT](../model_doc/vilt)ุ ุนูู ูุฌููุนุฉ ุจูุงูุงุช [`Graphcore/vqa`](https://huggingface.co/datasets/Graphcore/vqa). 
- ุงุณุชุฎุฏุงู ViLT ุงููุถุจูุท ูุณุจููุง ููุงุณุชูุชุงุฌ. 
- ุชุดุบูู ุงูุงุณุชุฏูุงู VQA ุจุฏูู ุชุฏุฑูุจ ูุน ูููุฐุฌ ุชูููุฏูุ ูุซู BLIP-2. 

## ุถุจุท ViLT ุงูุฏููู 

ูุชุถูู ูููุฐุฌ ViLT ุชุถููููุง ููุฑููุฒ ุงููุตูุฉ ูู ูุญูู ุงูุฑุคูุฉ (ViT)ุ ููุง ูุณูุญ ูู ุจุชุตููู ุงูุญุฏ ุงูุฃุฏูู ูููุงู ุงูุชุฏุฑูุจ ุนูู ุงูุฑุคูุฉ ูุงููุบุฉ (VLP). ููููู ุงุณุชุฎุฏุงู ูุฐุง ุงููููุฐุฌ ูุนุฏุฉ ููุงู ุฃุณูู ุงูููุฑ. ููููุง ูุชุนูู ุจูููุฉ VQAุ ูุชู ูุถุน ุฑุฃุณ ูุตูู ูู ุงูุฃุนูู (ุทุจูุฉ ุฎุทูุฉ ูู ุงูุฃุนูู ูู ุงูุญุงูุฉ ุงููุฎููุฉ ุงูููุงุฆูุฉ ูุฑููุฒ `[CLS]`) ููุชู ุชููุฆุชูุง ุจุดูู ุนุดูุงุฆู. ูุจุงูุชุงููุ ูุชู ุงูุชุนุงูู ูุน ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงูุจุตุฑูุฉ ุนูู ุฃููุง **ูุดููุฉ ุชุตููู**. 

ูุชุชุนุงูู ุงูููุงุฐุฌ ุงูุฃุญุฏุซุ ูุซู BLIP ูBLIP-2 ูInstructBLIPุ ูุน VQA ููููุฉ ุชูููุฏูุฉ. ููููุง ุจุนุฏ ูู ูุฐุง ุงูุฏูููุ ููุถุญ ููููุฉ ุงุณุชุฎุฏุงููุง ููุงุณุชุฏูุงู VQA ุจุฏูู ุชุฏุฑูุจ. 

ูุจู ุงูุจุฏุกุ ุชุฃูุฏ ูู ุชุซุจูุช ุฌููุน ุงูููุชุจุงุช ุงูุถุฑูุฑูุฉ. 

```bash
pip install -q transformers datasets
``` 

ููุดุฌุนู ุนูู ูุดุงุฑูุฉ ูููุฐุฌู ูุน ุงููุฌุชูุน. ุณุฌู ุงูุฏุฎูู ุฅูู ุญุณุงุจ Hugging Face ุงูุฎุงุต ุจู ูุชุญูููู ุฅูู ๐ค Hub. 

ุนูุฏ ุงููุทุงูุจุฉุ ุฃุฏุฎู ุฑูุฒู ููุชุณุฌูู: 

```py
>>> from huggingface_hub import notebook_login

>>> notebook_login()
``` 

ุฏุนูุง ูุญุฏุฏ ููุทุฉ ุชูุชูุด ุงููููุฐุฌ ููุชุบูุฑ ุนุงููู. 

```py
>>> model_checkpoint = "dandelin/vilt-b32-mlm"
``` 

## ุชุญููู ุงูุจูุงูุงุช 

ูุฃุบุฑุงุถ ุงูุชูุถูุญุ ูู ูุฐุง ุงูุฏูููุ ูุณุชุฎุฏู ุนููุฉ ุตุบูุฑุฉ ุฌุฏูุง ูู ูุฌููุนุฉ ุจูุงูุงุช ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงููุฑุฆูุฉ ุงูููุนููููุฉ `Graphcore/vqa`. 

ููููู ุงูุนุซูุฑ ุนูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ุนูู [๐ค Hub](https://huggingface.co/datasets/Graphcore/vqa). 

ููุจุฏูู ููุฌููุนุฉ ุจูุงูุงุช [`Graphcore/vqa`](https://huggingface.co/datasets/Graphcore/vqa)ุ ููููู ุชูุฒูู ููุณ ุงูุจูุงูุงุช ูุฏูููุง ูู ุตูุญุฉ ูุฌููุนุฉ ุจูุงูุงุช VQA ุงูุฑุณููุฉ https://visualqa.org/download.html. ุฅุฐุง ููุช ุชูุถู ุงุชุจุงุน ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุจุงุณุชุฎุฏุงู ุจูุงูุงุชู ุงููุฎุตุตุฉุ ูุฑุงุฌุน ููููุฉ [ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ุตูุฑุฉ](https://huggingface.co/docs/datasets/image_dataset#loading-script) ุงูุฏููู ูู ูุซุงุฆู ๐ค Datasets. 

ุฏุนูุง ูุญูู ุฃูู 200 ูุซุงู ูู ุงูุงููุณุงู ุงูุชุญูู ูู ุงูุตุญุฉ ููุณุชูุดู ููุฒุงุช ูุฌููุนุฉ ุงูุจูุงูุงุช: 

```python
>>> from datasets import load_dataset

>>> dataset = load_dataset("Graphcore/vqa", split="validation[:200]")
>>> dataset
Dataset({
features: ['question', 'question_type', 'question_id', 'image_id', 'answer_type', 'label'],
num_rows: 200
})
``` 

ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ูุซุงู ูููู ููุฒุงุช ูุฌููุนุฉ ุงูุจูุงูุงุช: 

```py
>>> dataset[0]
{'question': 'Where is he looking?',
'question_type': 'none of the above',
'question_id': 262148000,
'image_id': '/root/.cache/huggingface/datasets/downloads/extracted/ca733e0e000fb2d7a09fbcc94dbfe7b5a30750681d0e965f8e0a23b1c2f98c75/val2014/COCO_val2014_000000262148.jpg',
'answer_type': 'other',
'label': {'ids': ['at table', 'down', 'skateboard', 'table'],
'weights': [0.30000001192092896,
1.0,
0.30000001192092896,
0.30000001192092896]}}
``` 

ูุชุดูู ุงูููุฒุงุช ุฐุงุช ุงูุตูุฉ ุจุงููููุฉ ูุง ููู: 

- `question`: ุงูุณุคุงู ุงูุฐู ูุฌุจ ุงูุฅุฌุงุจุฉ ุนููู ูู ุงูุตูุฑุฉ. 
- `image_id`: ูุณุงุฑ ุงูุตูุฑุฉ ุงูุชู ูุดูุฑ ุฅูููุง ุงูุณุคุงู. 
- `label`: ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ. 

ูููููุง ุฅุฒุงูุฉ ุจููุฉ ุงูููุฒุงุช ูุฃููุง ูู ุชููู ุถุฑูุฑูุฉ: 

```py
>>> dataset = dataset.remove_columns(['question_type', 'question_id', 'answer_type'])
``` 

ููุง ุชุฑูุ ุชุญุชูู ููุฒุฉ `label` ุนูู ุนุฏุฉ ุฅุฌุงุจุงุช ูููุณ ุงูุณุคุงู (ุชุณูู `ids` ููุง) ุงูุชู ุฌูุนูุง ูุนูููู ุจุดุฑููู ูุฎุชูููู. 

ููุฑุฌุน ุฐูู ุฅูู ุฃู ุฅุฌุงุจุฉ ุงูุณุคุงู ูุฏ ุชููู ุฐุงุชูุฉ. ูู ูุฐู ุงูุญุงูุฉุ ูุงู ุงูุณุคุงู "ุฃูู ููุธุฑุ". ููุฏ ูุงู ุจุนุถ ุงูุฃุดุฎุงุต ุจุชุนููู ูุฐุง ุจู "down"ุ ุจูููุง ุนูู ุขุฎุฑูู ุจู "at table"ุ ูุนูู ุดุฎุต ุขุฎุฑ ุจู "skateboard"ุ ูููุฐุง. 

ุงูู ูุธุฑุฉ ุนูู ุงูุตูุฑุฉ ูููุฑ ูู ุงูุฅุฌุงุจุฉ ุงูุชู ุณุชูุฏููุง: 

```python
>>> from PIL import Image

>>> image = Image.open(dataset[0]['image_id'])
>>> image
``` 

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/tasks/vqa-example.png" alt="VQA Image Example"/>
</div> 

ูุจุณุจุจ ุบููุถ ุงูุฃุณุฆูุฉ ูุงูุฅุฌุงุจุงุชุ ูุชู ุงูุชุนุงูู ูุน ูุฌููุนุงุช ุงูุจูุงูุงุช ูุซู ูุฐู ุนูู ุฃููุง ูุดููุฉ ุชุตููู ูุชุนุฏุฏุฉ ุงูุชุตูููุงุช (ุญูุซ ูุฏ ุชููู ุฅุฌุงุจุงุช ูุชุนุฏุฏุฉ ุตุงูุญุฉ). ุนูุงูุฉ ุนูู ุฐููุ ุจุฏูุงู ูู ุฅูุดุงุก ุชุฑููุฒ ุซูุงุฆูุ ูุชู ุฅูุดุงุก ุชุฑููุฒ ูุงุนูุ ุจูุงุกู ุนูู ุนุฏุฏ ุงููุฑุงุช ุงูุชู ุธูุฑ ูููุง ุฅุฌุงุจุฉ ูุนููุฉ ูู ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ. 

ุนูู ุณุจูู ุงููุซุงูุ ูู ุงููุซุงู ุฃุนูุงูุ ูุฃู ุงูุฅุฌุงุจุฉ "down" ุชู ุงุฎุชูุงุฑูุง ุจุดูู ุฃูุจุฑ ุจูุซูุฑ ูู ุงูุฅุฌุงุจุงุช ุงูุฃุฎุฑูุ ูุฅู ููุง ุฏุฑุฌุฉ (ุชุณูู `weight` ูู ูุฌููุนุฉ ุงูุจูุงูุงุช) ูู 1.0ุ ูุจููุฉ ุงูุฅุฌุงุจุงุช ููุง ุฏุฑุฌุงุช <1.0. 

ููุงุญููุงุ ูู ุจุชููุฆุฉ ุงููููุฐุฌ ุจุฑุฃุณ ุชุตููู ููุงุณุจุ ุฏุนูุง ููุดุฆ ูุงููุณูู: ุฃุญุฏููุง ูููู ุจุชุนููู ุงุณู ุงูุชุตููู ุฅูู ุฑูู ุตุญูุญ ูุงูุนูุณ ุตุญูุญ: 

```py
>>> import itertools

>>> labels = [item['ids'] for item in dataset['label']]
>>> flattened_labels = list(itertools.chain(*labels))
>>> unique_labels = list(set(flattened_labels))

>>> label2id = {label: idx for idx, label in enumerate(unique_labels)}
>>> id2label = {idx: label for label, idx in label2id.items()}
``` 

ุงูุขู ุจุนุฏ ุฃู ุญุตููุง ุนูู ุงูุฎุฑุงุฆุทุ ูููููุง ุงุณุชุจุฏุงู ุงูุฅุฌุงุจุงุช ุงููุตูุฉ ุจูุนุฑูุงุชูุงุ ูุชุณุทูุญ ูุฌููุนุฉ ุงูุจูุงูุงุช ููุฒูุฏ ูู ุงููุนุงูุฌุฉ ุงููุณุจูุฉ. 

```python
>>> def replace_ids(inputs):
...   inputs["label"]["ids"] = [label2id[x] for x in inputs["label"]["ids"]]
...   return inputs


>>> dataset = dataset.map(replace_ids)
>>> flat_dataset = dataset.flatten()
>>> flat_dataset.features
{'question': Value(dtype='string', id=None),
'image_id': Value(dtype='string', id=None),
'label.ids': Sequence(feature=Value(dtype='int64', id=None), length=-1, id=None),
'label.weights': Sequence(feature=Value(dtype='float64', id=None), length=-1, id=None)}
``` 

## ุงูุจูุงูุงุช ุงูุณุงุจูุฉ 

ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชุญููู ูุนุงูุฌ ViLT ูุชุญุถูุฑ ุจูุงูุงุช ุงูุตูุฑุฉ ูุงููุต ูููููุฐุฌ. 

[`ViltProcessor`] ูุบูู ูุญูู BERT ููุนุงูุฌ ุตูุฑ ViLT ูู ูุนุงูุฌ ูุงุญุฏ ููุงุณุจ: 

```py
>>> from transformers import ViltProcessor

>>> processor = ViltProcessor.from_pretrained(model_checkpoint)
``` 

ููุนุงูุฌุฉ ุงูุจูุงูุงุชุ ูุญุชุงุฌ ุฅูู ุชุดููุฑ ุงูุตูุฑ ูุงูุฃุณุฆูุฉ ุจุงุณุชุฎุฏุงู [`ViltProcessor`]. ุณูุณุชุฎุฏู ุงููุนุงูุฌ [`BertTokenizerFast`] ูุชูููููุฒ ุงููุต ูุฅูุดุงุก `input_ids` ู`attention_mask` ู`token_type_ids` ูุจูุงูุงุช ุงููุต. 

ุฃูุง ุจุงููุณุจุฉ ููุตูุฑุ ูุณูุณุชููุฏ ุงููุนุงูุฌ ูู [`ViltImageProcessor`] ูุชุตุบูุฑ ุญุฌู ุงูุตูุฑุฉ ูุชุทุจูุนูุงุ ูุฅูุดุงุก `pixel_values` ู`pixel_mask`. 

ูุชู ุชูููุฐ ุฌููุน ุฎุทูุงุช ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ูุฐู ุชููุงุฆููุงุ ููุง ูุญุชุงุฌ ุฅูุง ุฅูู ุงุณุชุฏุนุงุก `processor`. ููุน ุฐููุ ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ุฅุนุฏุงุฏ ุงูุชุตูููุงุช ุงููุณุชูุฏูุฉ. ูู ูุฐุง ุงูุชูุซููุ ูุชูุงูู ูู ุนูุตุฑ ูุน ุฅุฌุงุจุฉ ูุญุชููุฉ (ุชุตููู). ูุจุงููุณุจุฉ ููุฅุฌุงุจุงุช ุงูุตุญูุญุฉุ ูุญุชูู ุงูุนูุตุฑ ุนูู ุฏุฑุฌุชู (ุงููุฒู)ุ ุจูููุง ูุชู ุชุนููู ุงูุนูุงุตุฑ ุงููุชุจููุฉ ุฅูู ุงูุตูุฑ. 

ุชููู ุงูุฏุงูุฉ ุงูุชุงููุฉ ุจุชุทุจูู `processor` ุนูู ุงูุตูุฑ ูุงูุฃุณุฆูุฉ ูุชูุณูู ุงูุชุตูููุงุช ููุง ูู ููุถุญ ุฃุนูุงู: 

```py
>>> import torch

>>> def preprocess_data(examples):
...     image_paths = examples['image_id']
...     images = [Image.open(image_path) for image_path in image_paths]
...     texts = examples['question']

...     encoding = processor(images, texts, padding="max_length", truncation=True, return_tensors="pt")

...     for k, v in encoding.items():
...           encoding[k] = v.squeeze()

...     targets = []

...     for labels, scores in zip(examples['label.ids'], examples['label.weights']):
...         target = torch.zeros(len(id2label))

...         for label, score in zip(labels, scores):
...             target[label] = score

...         targets.append(target)

...     encoding["labels"] = targets

...     return encoding
``` 

ูุชุทุจูู ุฏุงูุฉ ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ุนูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุงุ ุงุณุชุฎุฏู ูุธููุฉ ๐ค Datasets [`~datasets.map`]. ููููู ุชุณุฑูุน `map` ุนู ุทุฑูู ุชุนููู `batched=True` ููุนุงูุฌุฉ ุนูุงุตุฑ ูุชุนุฏุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูู ููุณ ุงูููุช. ูู ูุฐู ุงููุฑุญูุฉุ ูุง ุชุชุฑุฏุฏ ูู ุฅุฒุงูุฉ ุงูุฃุนูุฏุฉ ุงูุชู ูุง ุชุญุชุงุฌ ุฅูููุง. 

```py
>>> processed_dataset = flat_dataset.map(preprocess_data, batched=True, remove_columns=['question','question_type',  'question_id', 'image_id', 'answer_type', 'label.ids', 'label.weights'])
>>> processed_dataset
Dataset({
features: ['input_ids', 'token_type_ids', 'attention_mask', 'pixel_values', 'pixel_mask', 'labels'],
num_rows: 200
})
``` 

ููุฎุทูุฉ ุฃุฎูุฑุฉุ ูู ุจุฅูุดุงุก ุฏูุนุฉ ูู ุงูุฃูุซูุฉ ุจุงุณุชุฎุฏุงู [`DefaultDataCollator`]: 

```py
>>> from transformers import DefaultDataCollator

>>> data_collator = DefaultDataCollator()
```
ุจุงูุชุฃููุฏุ ุณุฃุชุจุน ุชุนูููุงุชู ูุณุฃุชุฑุฌู ููุท ุงููุต ุงูููุฌูุฏ ูู ุงูููุฑุงุช ูุงูุนูุงููู:

## ุชุฏุฑูุจ ุงููููุฐุฌ

ุงูุขู ุฃูุช ูุณุชุนุฏ ูุจุฏุก ุชุฏุฑูุจ ูููุฐุฌู! ูู ุจุชุญููู ViLT ูุน [`ViltForQuestionAnswering`]. ุญุฏุฏ ุนุฏุฏ ุงูุชุตูููุงุช ุฅูู ุฌุงูุจ ุชุนูููุงุช ุงูุชุตููู:

ูู ูุฐู ุงููุฑุญูุฉุ ูู ูุชุจู ุณูู ุซูุงุซ ุฎุทูุงุช:

1. ุญุฏุฏ ูุฑุท ูุนููุงุช ุงูุชุฏุฑูุจ ุงูุฎุงุตุฉ ุจู ูู [`TrainingArguments`]:

```py
>>> ูู ุงููุญููุงุช ุงุณุชูุฑุงุฏ TrainingArguments

 >>> repo_id = "MariaK/vilt_finetuned_200"

 >>> training_args = TrainingArguments(
... train_batch_size=4ุ
... num_train_epochs=20ุ
... save_steps=200ุ
... logging_steps=50ุ
... learning_rate=5e-5ุ
... save_total_limit=2ุ
... remove_unused_columns=Falseุ
... push_to_hub=Trueุ
... )
```

2. ูู ุจุชูุฑูุฑ ุงูุญุฌุฌ ุงูุชุฏุฑูุจูุฉ ุฅูู [`Trainer`] ุฌูุจูุง ุฅูู ุฌูุจ ูุน ุงููููุฐุฌ ููุฌููุนุฉ ุงูุจูุงูุงุช ูุงููุนุงูุฌ ููุฌูุน ุงูุจูุงูุงุช.

```py
>>> ูู ุงููุญููุงุช ุงุณุชูุฑุงุฏ ุงููุฏุฑุจ

 >>> trainer = Trainer(
... model=modelุ
... args=training_argsุ
... data_collator=data_collatorุ
... train_dataset=processed_datasetุ
... tokenizer=processor
... )
```

3. ุงุณุชุฏุนุงุก [`~Trainer.train`] ูุถุจุท ูููุฐุฌู.

```py
>>> trainer.train()
```

ุจูุฌุฑุฏ ุงูุงูุชูุงุก ูู ุงูุชุฏุฑูุจุ ุดุงุฑู ูููุฐุฌู ูู Hub ุจุงุณุชุฎุฏุงู ุทุฑููุฉ [`~Trainer.push_to_hub`] ููุดุงุฑูุฉ ูููุฐุฌู ุงูููุงุฆู ุนูู ๐ค Hub:

```py
>>> trainer.push_to_hub()
```

## ุงูุงุณุชูุชุงุฌ

ุงูุขู ุจุนุฏ ุฃู ุถุจุทุช ูููุฐุฌ ViLTุ ูููุช ุจุชุญูููู ุฅูู ๐ค Hubุ ููููู ุงุณุชุฎุฏุงูู ููุงุณุชูุชุงุฌ. ุฃุณูู ุทุฑููุฉ ูุชุฌุฑุจุฉ ูููุฐุฌู ุงูููุฏุฑุจ ููุงุณุชูุชุงุฌ ูู ุงุณุชุฎุฏุงูู ูู [`Pipeline`].

```py
>>> ูู ุงููุญููุงุช ุงุณุชูุฑุงุฏ ุงูุฃูุงุจูุจ

 >>> pipe = pipeline("visual-question-answering"ุ model="MariaK/vilt_finetuned_200")
```

ุชู ุชุฏุฑูุจ ุงููููุฐุฌ ูู ูุฐุง ุงูุฏููู ุนูู 200 ูุซุงู ููุทุ ูุฐุง ูุง ุชุชููุน ุงููุซูุฑ ููู. ุฏุนููุง ูุฑู ูุง ุฅุฐุง ูุงู ูุฏ ุชุนูู ุดูุฆูุง ุนูู ุงูุฃูู ูู ุงูุจูุงูุงุช ูุฎุฐ ุงููุซุงู ุงูุฃูู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุชูุถูุญ ุงูุงุณุชุฏูุงู:

```py
>>> example = dataset[0]
>>> image = Image.open(example['image_id'])
>>> question = example['question']
>>> print(question)
>>> pipe(imageุ questionุ top_k=1)
"ุฃูู ููุธุฑุ"
[{'score': 0.5498199462890625ุ 'answer': 'down'}]
```

ุนูู ุงูุฑุบู ูู ุนุฏู ุงูุซูุฉุ ุฅูุง ุฃู ุงููููุฐุฌ ูุฏ ุชุนูู ุจุงููุนู ุดูุฆูุง ูุง. ูุน ุงููุฒูุฏ ูู ุงูุฃูุซูุฉ ููุชุฑุงุช ุงูุชุฏุฑูุจ ุงูุฃุทููุ ุณุชุญุตู ุนูู ูุชุงุฆุฌ ุฃูุถู ุจูุซูุฑ!

ููููู ุฃูุถูุง ุฅุนุงุฏุฉ ุฅูุชุงุฌ ูุชุงุฆุฌ ุงูุฃูุจูุจ ูุฏูููุง ุฅุฐุง ุฃุฑุฏุช:

1. ุฎุฐ ุตูุฑุฉ ูุณุคุงูุ ููู ุจุฅุนุฏุงุฏููุง ูููููุฐุฌ ุจุงุณุชุฎุฏุงู ุงููุนุงูุฌ ูู ูููุฐุฌู.

2. ูู ุจุชูุฑูุฑ ูุชูุฌุฉ ูุง ูุจู ุงููุนุงูุฌุฉ ุฃู ูู ุฎูุงู ุงููููุฐุฌ.

3. ูู logitsุ ุงุญุตู ุนูู ูุนุฑู ุงูุฅุฌุงุจุฉ ุงูุฃูุซุฑ ุงุญุชูุงููุงุ ูุงุนุซุฑ ุนูู ุงูุฅุฌุงุจุฉ ุงููุนููุฉ ูู `id2label`.

```py
>>> processor = ViltProcessor.from_pretrained("MariaK/vilt_finetuned_200")

>>> image = Image.open(example['image_id'])
>>> question = example['question']

>>> # ุฅุนุฏุงุฏ ุงููุฏุฎูุงุช
>>> ุงููุฏุฎูุงุช = ุงููุนุงูุฌ (ุงูุตูุฑุฉุ ุงูุณุคุงูุ return_tensors="pt")

>>> model = ViltForQuestionAnswering.from_pretrained("MariaK/vilt_finetuned_200")

>>> # ุชูุฑูุฑ ุฅูู ุงูุฃูุงู
>>> ูุน ุงูุดุนูุฉ. ูุง_grad ():
... ุฅุฎุฑุงุฌ = ุงููููุฐุฌ (** ุงููุฏุฎูุงุช)

>>> logits = outputs.logits
>>> idx = logits.argmax (-1).item ()
>>> print ("ุงูุฅุฌุงุจุฉ ุงููุชููุนุฉ:"ุ model.config.id2label [idx])
ุงูุฅุฌุงุจุฉ ุงููุชููุนุฉ: ุฃุณูู
```

## VQA ุจุฏูู ุชุตููุฑ

ุนุงูู ุงููููุฐุฌ ุงูุณุงุจู VQA ูููุงู ุชุตููู. ุชุนุงูู ุจุนุถ ุงูููุงุฐุฌ ุงูุญุฏูุซุฉุ ูุซู BLIP ูBLIP-2 ูInstructBLIPุ ูุน VQA ููููุฉ ุชูููุฏูุฉ. ุฏุนูุง ูุฃุฎุฐ [BLIP-2](../model_doc/blip-2) ููุซุงู. ููุฏ ูุฏู ูููุฐุฌูุง ุฌุฏูุฏูุง ููุชุนูู ุงูุชููุงุฆู ููุฑุคูุฉ ูุงููุบุฉ ุญูุซ ูููู ุงุณุชุฎุฏุงู ุฃู ูุฒูุฌ ูู ูุดูุฑ ุงูุฑุคูุฉ ุงููุณุจู ุงูุชุฏุฑูุจ ูLLM (ุชุนุฑู ุนูู ุงููุฒูุฏ ูู ููุดูุฑ ุงููุฏููุฉ [BLIP-2](https://huggingface.co/blog/blip-2)).

ูุชูุญ ุฐูู ุชุญููู ูุชุงุฆุฌ ุฑุงุฆุฏุฉ ุนูู ูุณุชูู ุงูููุงู ุงููุฑุฆูุฉ ุงููุบููุฉ ุงููุชุนุฏุฏุฉ ุจูุง ูู ุฐูู ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงููุฑุฆูุฉ.

ุฏุนููุง ููุถุญ ููู ููููู ุงุณุชุฎุฏุงู ูุฐุง ุงููููุฐุฌ ูู VQA. ุฃููุงูุ ุฏุนูุง ูุญูู ุงููููุฐุฌ. ููุง ุณูุฑุณู ุงููููุฐุฌ ุตุฑุงุญุฉ ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณูููุงุชุ ุฅุฐุง ูุงูุช ูุชููุฑุฉุ ูุงูุชู ูู ููู ุจุญุงุฌุฉ ุฅูู ุงูููุงู ุจูุง ุณุงุจููุง ุนูุฏ ุงูุชุฏุฑูุจุ ุญูุซ ูุชุนุงูู [`Trainer`] ูุน ุฐูู ุชููุงุฆููุง:

```py
>>> ูู ุงููุญููุงุช ุงุณุชูุฑุงุฏ AutoProcessorุ Blip2ForConditionalGeneration
>>> ุงุณุชูุฑุงุฏ ุงูุดุนูุฉ

>>> ุงููุนุงูุฌ = AutoProcessor.from_pretrained("Salesforce/blip2-opt-2.7b")
>>> model = Blip2ForConditionalGeneration.from_pretrained("Salesforce/blip2-opt-2.7b"ุ torch_dtype=torch.float16)
>>> ุงูุฌูุงุฒ = "cuda" ุฅุฐุง ูุงู torch.cuda.is_available () else "cpu"
>>> model.to (ุงูุฌูุงุฒ)
```

ูุฃุฎุฐ ุงููููุฐุฌ ุงูุตูุฑุฉ ูุงููุต ูุฅุฏุฎุงูุ ูุฐุง ุฏุนูุง ูุณุชุฎุฏู ููุณ ุฒูุฌ ุงูุตูุฑุฉ/ุงูุณุคุงู ุจุงูุถุจุท ูู ุงููุซุงู ุงูุฃูู ูู ูุฌููุนุฉ ุจูุงูุงุช VQA:

```py
>>> example = dataset[0]
>>> image = Image.open(example['image_id'])
>>> question = example['question']
```

ูุงุณุชุฎุฏุงู BLIP-2 ููููุฉ ุงูุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ ุงููุฑุฆูุฉุ ูุฌุจ ุฃู ูุชุจุน ุงููุต ุงูููุฑู ุชูุณูููุง ูุญุฏุฏูุง: `Question: {} Answer:`.

```py
>>> ุงูููุฑู = "ุงูุณุคุงู: {} ุงูุฅุฌุงุจุฉ:"
```

ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ูุนุงูุฌุฉ ุงูุตูุฑุฉ/ุงูููุฑู ูุน ุงููุนุงูุฌ ุงูุฎุงุต ุจุงููููุฐุฌุ ูุชูุฑูุฑ ุงูุฅุฏุฎุงู ุงููุนุงูุฌ ุนุจุฑ ุงููููุฐุฌุ ููู ุชุดููุฑ ุงูุฅุฎุฑุงุฌ:

```py
>>> ุงููุฏุฎูุงุช = ุงููุนุงูุฌ (ุงูุตูุฑุฉุ ุงููุต = ุงูููุฑูุ return_tensors="pt").to (ุงูุฌูุงุฒุ torch.float16)

>>> generated_ids = model.generate (** ุงููุฏุฎูุงุชุ max_new_tokens=10)
>>> generated_text = processor.batch_decode (generated_idsุ skip_special_tokens=True) [0].strip ()
>>> print (generated_text)
"ุฅูู ููุธุฑ ุฅูู ุงูุญุดุฏ"
```

ููุง ุชุฑููุ ุชุนุฑู ุงููููุฐุฌ ุนูู ุงูุญุดุฏ ูุงุชุฌุงู ุงููุฌู (ููุธุฑ ุฅูู ุงูุฃุณูู)ุ ููุน ุฐููุ ูุจุฏู ุฃูู ูุบูู ุนู ุญูููุฉ ุฃู ุงูุญุดุฏ ููุฌูุฏ ุฎูู ุงููุชุฒูุฌ. ููุน ุฐููุ ูู ุงูุญุงูุงุช ุงูุชู ูููู ูู ุบูุฑ ุงูุนููู ูููุง ุงูุญุตูู ุนูู ูุฌููุนุงุช ุจูุงูุงุช ุจุดุฑูุฉ ููุณููุฉุ ูููู ุฃู ููุชุฌ ูุฐุง ุงูููุฌ ูุชุงุฆุฌ ูููุฏุฉ ุจุณุฑุนุฉ.