تتيح تقطير اتساق المسار (TCD) لنموذج إنشاء صور أعلى جودة وأكثر تفصيلاً باستخدام عدد أقل من الخطوات. علاوة على ذلك، وبفضل التخفيف الفعال من الأخطاء أثناء عملية التقطير، يظهر TCD أداءً متفوقًا حتى في ظل ظروف خطوات الاستنتاج الكبيرة.

المزايا الرئيسية لـ TCD هي:

- أفضل من المعلم: يظهر TCD جودة توليد متفوقة في كل من خطوات الاستنتاج الصغيرة والكبيرة ويتجاوز أداء DPM-Solver++(2S) مع Stable Diffusion XL (SDXL). لا توجد أية ميزات تمييز أو إشراف LPIPS مدرجة أثناء تدريب TCD.

- خطوات الاستدلال المرنة: يمكن ضبط خطوات الاستدلال لعيّنة TCD بحرية دون التأثير سلبًا على جودة الصورة.

- تغيير مستوى التفاصيل بحرية: أثناء الاستدلال، يمكن ضبط مستوى التفاصيل في الصورة باستخدام معلمة واحدة، غاما.

للاطلاع على المزيد من التفاصيل التقنية حول TCD، يرجى الرجوع إلى الورقة البحثية أو صفحة المشروع الرسمية.

بالنسبة للنماذج الكبيرة مثل SDXL، يتم تدريب TCD مع LoRA لتقليل استخدام الذاكرة. وهذا مفيد أيضًا لأنه يمكنك إعادة استخدام LoRAs بين النماذج الدقيقة المختلفة، طالما أنها تشترك في نفس النموذج الأساسي، دون الحاجة إلى تدريب إضافي.

سيوضح هذا الدليل كيفية إجراء الاستدلال باستخدام TCD-LoRAs لمجموعة متنوعة من المهام مثل النص إلى الصورة وملء الفراغات، بالإضافة إلى كيفية الجمع بين TCD-LoRAs وموائمات أخرى بسهولة. اختر أحد النماذج الأساسية المدعومة ونقطة تفتيش TCD-LoRA المقابلة من الجدول أدناه للبدء.

تأكد من تثبيت PEFT للحصول على دعم LoRA أفضل.

بالنسبة للمهام العامة، دعونا نستخدم StableDiffusionXLPipeline و TCDScheduler في هذا الدليل. استخدم طريقة load_lora_weights لتحميل أوزان TCD-LoRA المتوافقة مع SDXL.

فيما يلي بعض النصائح التي يجب مراعاتها عند الاستدلال باستخدام TCD-LoRA:

- حافظ على num_inference_steps بين 4 و50.

- قم بتعيين eta (يستخدم للتحكم في العشوائية في كل خطوة) بين 0 و1. يجب استخدام Eta أعلى عند زيادة عدد خطوات الاستدلال، ولكن الجانب السلبي هو أن Eta أكبر في TCDScheduler يؤدي إلى صور أكثر ضبابية. القيمة الموصى بها هي 0.3 لإنتاج نتائج جيدة.

بالنسبة لمهمة النص إلى الصورة، إليك مثال على كيفية استخدام TCD-LoRA:

![صورة توضيحية](https://github.com/jabir-zheng/TCD/raw/main/assets/demo_image.png)

بالنسبة لمهمة ملء الفراغات، يوضح المثال التالي كيفية استخدام TCD-LoRA:

![صورة ملء الفراغات باستخدام TCD](https://github.com/jabir-zheng/TCD/raw/main/assets/inpainting_tcd.png)

يعمل TCD-LoRA أيضًا مع العديد من النماذج الدقيقة الإضافية والمكونات الإضافية التي أنشأها المجتمع. على سبيل المثال، قم بتحميل نقطة تفتيش animagine-xl-3.0، والتي تعد نسخة دقيقة من المجتمع لـ SDXL لإنشاء صور أنيمي.

![صورة أنيمي باستخدام TCD-LoRA](https://github.com/jabir-zheng/TCD/raw/main/assets/animagine_xl.png)

يدعم TCD-LoRA أيضًا موائمات LoRA الأخرى المدربة على أنماط مختلفة. على سبيل المثال، دعنا نحمل TheLastBen/Papercut_SDXL LoRA وندمجها مع TCD-LoRA باستخدام طريقة set_adapters.

![صورة بأسلوب الورق المقصوص باستخدام TCD-LoRA](https://github.com/jabir-zheng/TCD/raw/main/assets/styled_lora.png)

TCD-LoRA متعدد الاستخدامات ويمكن دمجه مع أنواع أخرى من الموائمات مثل ControlNets وIP-Adapter وAnimateDiff.
بالتأكيد، سأتبع تعليماتك وسأترجم فقط النص الموجود في الفقرات والعناوين.

### Depth ControlNet
تعد Depth ControlNet طريقة جديدة لتوجيه Stable Diffusion لإنشاء صور بناءً على خريطة العمق للصورة. يمكن أن يساعد تضمين معلومات العمق في إنشاء صور أكثر واقعية مع منظور أفضل.

في هذا المثال، نستخدم نموذجًا مسبق التدريب يسمى "Intel/dpt-hybrid-midas" لاستخراج خريطة العمق من الصورة. ثم يتم استخدام خريطة العمق هذه كإدخال لنموذج Stable Diffusion جنبًا إلى جنب مع موجه نصي.

يتم ضبط معلمة "controlnet_conditioning_scale" على 0.5 للحصول على أفضل تعميم. يمكن تجربة قيم مختلفة لهذه المعلمة اعتمادًا على الصورة والموجه المستخدم.

### Canny ControlNet
Canny ControlNet هي تقنية أخرى لتوجيه Stable Diffusion باستخدام حواف الصورة. في هذا المثال، يتم استخدام صورة طائر ملونة، ويتم تطبيق مرشح Canny لإستخراج الحواف. ثم يتم استخدام هذه الصورة ذات الحواف كإدخال لنموذج Stable Diffusion.

مرة أخرى، يتم ضبط "controlnet_conditioning_scale" على 0.5 للحصول على نتائج عامة جيدة. يمكن للمستخدمين ضبط هذه القيمة اعتمادًا على الصورة والموجه المحدد.

<Tip>
قد لا تعمل معلمات الاستنتاج في هذا المثال مع جميع الصور، لذلك نوصي بتجربة قيم مختلفة لمعلمات "num_inference_steps" و "guidance_scale" و "controlnet_conditioning_scale" و "cross_attention_kwargs" واختيار الأنسب منها.
</Tip>

<hfoption id="IP-Adapter">
يوضح هذا المثال كيفية استخدام TCD-LoRA مع [IP-Adapter](https://github.com/tencent-ailab/IP-Adapter/tree/main) و SDXL. يستخدم IP-Adapter ترميزًا قويًا للصور لإنشاء صور عالية الجودة بناءً على صورة مرجعية.

في هذا المثال، يتم استخدام صورة مرجعية لامرأة، ويتم تطبيق موجه نصي لإنشاء صورة جديدة مع نظارات شمسية. يتم استخدام IP-Adapter مع TCD-LoRA لتحسين جودة الصورة وسرعة عملية الاستنتاج.

</hfoption>

<hfoption id="AnimateDiff">
تتيح مكتبة "AnimateDiff" إمكانية تحريك الصور باستخدام نماذج Stable Diffusion. يمكن أن يؤدي استخدام TCD-LoRA مع AnimateDiff إلى تسريع عملية التحريك بشكل كبير دون المساس بجودة الصورة. في الواقع، يمكن أن يؤدي استخدام TCD-LoRA إلى تحسين جودة التحريك، مما ينتج عنه مظهر أكثر وضوحًا.

في هذا المثال، يتم استخدام موجه نصي لتحريك شخصية أنثى مع خلفية مشوشة. يتم استخدام TCD-LoRA مع AnimateDiff لإنشاء 24 إطارًا متحركًا، ويتم تصديرها كملف GIF.

</hfoption>