# ููู ุงูุฃูุงุจูุจ ูุงูููุงุฐุฌ ูุฌุฏุงูู ุงูููุงุนูุฏ 

ุตูููุช ุฃุฏูุงุช ุงููุดุฑ ูุชููู ุตูุฏูู ุฃุฏูุงุช ุณูู ุงูุงุณุชุฎุฏุงู ููุฑููุง ูุฅูุดุงุก ุฃูุธูุฉ ูุดุฑ ูุฎุตุตุฉ ูุญุงูุชู ุงูุงุณุชุฎุฏุงููุฉ. ุงูููุงุฐุฌ ูุฌุฏุงูู ุงูููุงุนูุฏ ูู ุฌููุฑ ุตูุฏูู ุงูุฃุฏูุงุช. ูู ุญูู ุฃู [DiffusionPipeline] ุชุฌูุน ูุฐู ุงูููููุงุช ูุนูุง ููุฑุงุญุฉุ ููููู ุฃูุถูุง ุฅูุบุงุก ุญุฒู ุงูุฃูุจูุจ ูุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุฌุฏุงูู ุงูููุงุนูุฏ ุจุดูู ูููุตู ูุฅูุดุงุก ุฃูุธูุฉ ูุดุฑ ุฌุฏูุฏุฉ.

ูู ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนููููุ ุณุชุชุนูู ููููุฉ ุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุฌุฏุงูู ุงูููุงุนูุฏ ูุชุฌููุน ูุธุงู ูุดุฑ ููุงุณุชุฏูุงูุ ุจุฏุกูุง ูู ุฎุท ุฃูุงุจูุจ ุฃุณุงุณู ุซู ุงูุงูุชูุงู ุฅูู ุฎุท ุฃูุงุจูุจ ุงููุดุฑ ุงููุณุชูุฑ.

## ูู ุฎุท ุฃูุงุจูุจ ุฃุณุงุณู

ุฎุท ุงูุฃูุงุจูุจ ูู ุทุฑููุฉ ุณุฑูุนุฉ ูุณููุฉ ูุชุดุบูู ูููุฐุฌ ููุงุณุชุฏูุงูุ ููุง ูุชุทูุจ ุฃูุซุฑ ูู ุฃุฑุจุนุฉ ุฃุณุทุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุชูููุฏ ุตูุฑุฉ:

ูู ุงููุซุงู ุฃุนูุงูุ ูุญุชูู ุฎุท ุงูุฃูุงุจูุจ ุนูู ูููุฐุฌ [UNet2DModel] ูุฌุฏูู ููุงุนูุฏ [DDPMScheduler]. ูููู ุฎุท ุงูุฃูุงุจูุจ ุจุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ ุนู ุทุฑูู ุฃุฎุฐ ุถูุถุงุก ุนุดูุงุฆูุฉ ุจุญุฌู ุงูุฅุฎุฑุงุฌ ุงููุทููุจ ููุฑูุฑู ุนุจุฑ ุงููููุฐุฌ ุนุฏุฉ ูุฑุงุช. ูู ูู ุฎุทูุฉ ุฒูููุฉุ ูุชูุจุฃ ุงููููุฐุฌ ุจ *ุจูุงูุง ุงูุถูุถุงุก* ููุณุชุฎุฏููุง ุงูุฌุฏูู ุงูุฒููู ููุชูุจุค ุจุตูุฑุฉ ุฃูู ุถูุถุงุกู. ููุฑุฑ ุฎุท ุงูุฃูุงุจูุจ ูุฐู ุงูุนูููุฉ ุญุชู ูุตู ุฅูู ููุงูุฉ ุนุฏุฏ ุฎุทูุงุช ุงูุงุณุชุฏูุงู ุงููุญุฏุฏุฉ.

ูุฅุนุงุฏุฉ ุฅูุดุงุก ุฎุท ุงูุฃูุงุจูุจ ุจุงุณุชุฎุฏุงู ุงููููุฐุฌ ูุฌุฏูู ุงูููุงุนูุฏ ุจุดูู ูููุตูุ ุฏุนูุง ููุชุจ ุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุงูุฎุงุตุฉ ุจูุง.

1. ูู ุจุชุญููู ุงููููุฐุฌ ูุฌุฏูู ุงูููุงุนูุฏ:

```py
>>> ูู ุงููุงุดุฑูู ุงุณุชูุฑุงุฏ DDPMSchedulerุ UNet2DModel

>>> ุฌุฏูู ุงูููุงุนูุฏ = DDPMScheduler.from_pretrained ("google/ddpm-cat-256")
>>> model = UNet2DModel.from_pretrained ("google/ddpm-cat-256", use_safetensors = True).to ("cuda")
```

2. ูู ุจุชุนููู ุนุฏุฏ ุงูุฎุทูุงุช ุงูุฒูููุฉ ูุชุดุบูู ุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก:

```py
>>> ุฌุฏูู ุงูููุงุนูุฏ. set_timesteps (50)
```

3. ูุคุฏู ุชุนููู ุฎุทูุงุช ุฌุฏูู ุงูููุงุนูุฏ ุฅูู ุฅูุดุงุก ูุตูููุฉ ุฐุงุช ุนูุงุตุฑ ูุชุจุงุนุฏุฉ ุจุงูุชุณุงูู ูููุงุ 50 ูู ูุฐุง ุงููุซุงู. ูุฑุชุจุท ูู ุนูุตุฑ ุจุฎุทูุฉ ุฒูููุฉ ูููู ูููุง ุงููููุฐุฌ ุจุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ. ุนูุฏูุง ุชููู ุจุฅูุดุงุก ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ูุงุญููุงุ ูุณุชููู ุจุงูุชุนููู ููู ูุฐู ุงููุตูููุฉ ูุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ:

```py
>>> ุฌุฏูู ุงูููุงุนูุฏ. ุงูููุงุนูุฏ ุงูุฒูููุฉ
ูุตูููุฉ ([980ุ 960ุ 940ุ 920ุ 900ุ 880ุ 860ุ 840ุ 820ุ 800ุ 780ุ 760ุ 740ุ 720ุ
700ุ 680ุ 660ุ 640ุ 620ุ 600ุ 580ุ 560ุ 540ุ 520ุ 500ุ 480ุ 460ุ 440ุ
420ุ 400ุ 380ุ 360ุ 340ุ 320ุ 300ุ 280ุ 260ุ 240ุ 220ุ 200ุ 180ุ 160ุ
140ุ 120ุ 100ุ 80ุ 60ุ 40ุ 20ุ 0])
```

4. ูู ุจุฅูุดุงุก ุจุนุถ ุงูุถูุถุงุก ุงูุนุดูุงุฆูุฉ ุจููุณ ุดูู ุงูุฅุฎุฑุงุฌ ุงููุทููุจ:

```py
>>> ุงุณุชูุฑุงุฏ ุงูุดุนูุฉ

>>> ุญุฌู ุงูุนููุฉ = model.config.sample_size
>>> ุงูุถูุถุงุก = ุงูุดุนูุฉ. randn ((1ุ 3ุ ุญุฌู ุงูุนููุฉุ ุญุฌู ุงูุนููุฉ)ุ ุงูุฌูุงุฒ = "cuda")
```

5. ุงูุขู ุงูุชุจ ุญููุฉ ููุชุนููู ููู ุงูุฎุทูุงุช ุงูุฒูููุฉ. ูู ูู ุฎุทูุฉ ุฒูููุฉุ ูููู ุงููููุฐุฌ ุจุชูููุฐ ุชูุฑูุฑุฉ [UNet2DModel.forward] ููุนูุฏ ุจูุงูุง ุงูุถูุถุงุก. ุชุณุชุฎุฏู ุทุฑููุฉ [~ DDPMScheduler.step] ุงูุฎุงุตุฉ ุจุฌุฏูู ุงูููุงุนูุฏ ุจูุงูุง ุงูุถูุถุงุก ูุงูุฎุทูุฉ ุงูุฒูููุฉ ูุงูุฅุฏุฎุงู ููุชูุจุค ุจุงูุตูุฑุฉ ูู ุงูุฎุทูุฉ ุงูุฒูููุฉ ุงูุณุงุจูุฉ. ูุตุจุญ ูุฐุง ุงูุฅุฎุฑุงุฌ ุงูุฅุฏุฎุงู ุงูุชุงูู ูููููุฐุฌ ูู ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุกุ ูุณูู ูุชูุฑุฑ ุญุชู ูุตู ุฅูู ููุงูุฉ ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ".

```py
>>> ุงูุฅุฏุฎุงู = ุงูุถูุถุงุก

>>> ููู t ูู ุฌุฏูู ุงูููุงุนูุฏ. ุงูููุงุนูุฏ ุงูุฒูููุฉ:
... ูุน ุงูุดุนูุฉ. ูุง_grad ():
... ุจูุงูุง ุงูุถูุถุงุก ุงููุชูููุฉ = model (inputุ t). sample
... ุงูุนููุฉ ุงูุถูุถุงุก ุงูุณุงุจูุฉ = ุฌุฏูู ุงูููุงุนูุฏ. step (noisy_residualุ tุ input). prev_sample
... ุงูุฅุฏุฎุงู = ุงูุนููุฉ ุงูุถูุถุงุก ุงูุณุงุจูุฉ
```

ูุฐู ูู ุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุจุฃููููุงุ ูููููู ุงุณุชุฎุฏุงู ูุฐุง ุงูููุท ููุณู ููุชุงุจุฉ ุฃู ูุธุงู ูุดุฑ.

6. ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุชุญููู ุงูุฅุฎุฑุงุฌ ุงูุฎุงูู ูู ุงูุถูุถุงุก ุฅูู ุตูุฑุฉ:

```py
>>> ูู ุตูุฑุฉ PIL ุงุณุชูุฑุงุฏ ุงูุตูุฑุฉ
>>> ุงุณุชูุฑุงุฏ numpy ููุง np

>>> ุงูุตูุฑุฉ = (ุงูุฅุฏุฎุงู / 2 + 0.5). clamp (0ุ 1). squeeze ()
>>> ุงูุตูุฑุฉ = (ุงูุตูุฑุฉ. permute (1ุ 2ุ 0) * 255). round (). to (torch.uint8). cpu (). numpy ()
>>> ุงูุตูุฑุฉ = Image.fromarray (ุงูุตูุฑุฉ)
>>> ุงูุตูุฑุฉ
```

ูู ุงููุณู ุงูุชุงููุ ุณุชุฎุชุจุฑ ููุงุฑุงุชู ุนู ุทุฑูู ุชูููู ุฎุท ุฃูุงุจูุจ ูุดุฑ ูุณุชูุฑ ุฃูุซุฑ ุชุนููุฏูุง. ุงูุฎุทูุงุช ูู ููุณูุง ุชูุฑูุจูุง. ุณุชููู ุจุชููุฆุฉ ุงูููููุงุช ุงููุงุฒูุฉุ ูุชุนููู ุนุฏุฏ ุงูุฎุทูุงุช ุงูุฒูููุฉ ูุฅูุดุงุก ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ". ูุชู ุงุณุชุฎุฏุงู ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ" ูู ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุกุ ููู ูู ุนูุตุฑ ูู ูุฐุง ุงูุตูููุ ูุชูุจุฃ ุงููููุฐุฌ ุจุตูุฑุฉ ุฃูู ุถูุถุงุกู. ุชุชุนููู ุงูุญููุฉ ุงูุฎุงููุฉ ูู ุงูุถูุถุงุก ููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ"ุ ููู ูู ุฎุทูุฉ ุฒูููุฉุ ุชููู ุจุฅุฎุฑุงุฌ ุจูุงูุง ุงูุถูุถุงุก ููุณุชุฎุฏููุง ุงูุฌุฏูู ุงูุฒููู ููุชูุจุค ุจุตูุฑุฉ ุฃูู ุถูุถุงุกู ูู ุงูุฎุทูุฉ ุงูุฒูููุฉ ุงูุณุงุจูุฉ. ุชุชูุฑุฑ ูุฐู ุงูุนูููุฉ ุญุชู ุชุตู ุฅูู ููุงูุฉ ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ".

ุฏุนูุง ูุฌุฑุจ ุฐูู!

## ูู ุฎุท ุฃูุงุจูุจ ุงููุดุฑ ุงููุณุชูุฑ

ุงููุดุฑ ุงููุณุชูุฑ ูู ูููุฐุฌ ูุดุฑ ูุตู ุฅูู ุตูุฑุฉ *ูุดุฑ ุฎูู*. ูุทูู ุนููู ูููุฐุฌ ูุดุฑ ุฎูู ูุฃูู ูุนูู ูุน ุชูุซูู ููุฎูุถ ุงูุฃุจุนุงุฏ ููุตูุฑุฉ ุจุฏูุงู ูู ูุณุงุญุฉ ุงูุจูุณู ุงููุนููุฉุ ููุง ูุฌุนูู ุฃูุซุฑ ููุงุกุฉ ูู ุงูุฐุงูุฑุฉ. ูููู ุงููุดูุฑ ุจุถุบุท ุงูุตูุฑุฉ ุฅูู ุชูุซูู ุฃุตุบุฑุ ููุชู ุงุณุชุฎุฏุงู ูู ุชุดููุฑ ูุชุญููู ุงูุชูุซูู ุงููุถุบูุท ูุฑุฉ ุฃุฎุฑู ุฅูู ุตูุฑุฉ. ุจุงููุณุจุฉ ูููุงุฐุฌ ุงููุต ุฅูู ุงูุตูุฑุฉุ ุณุชุญุชุงุฌ ุฅูู ูุญุฏุฏ ููุถุนู ููุดูุฑ ูุฅูุดุงุก ุชุถูููุงุช ูุตูุฉ. ูู ุงููุซุงู ุงูุณุงุจูุ ุฃูุช ุชุนุฑู ุจุงููุนู ุฃูู ุจุญุงุฌุฉ ุฅูู ูููุฐุฌ UNet ูุฌุฏูู ููุงุนูุฏ.

ููุง ุชุฑููุ ูุฐุง ุฃูุซุฑ ุชุนููุฏูุง ุจุงููุนู ูู ุฎุท ุฃูุงุจูุจ DDPM ุงูุฐู ูุญุชูู ููุท ุนูู ูููุฐุฌ UNet. ูุญุชูู ูููุฐุฌ ุงููุดุฑ ุงููุณุชูุฑ ุนูู ุซูุงุซุฉ ููุงุฐุฌ ูุณุจูุฉ ุงูุชุฏุฑูุจ ูููุตูุฉ.

๐ก ุงูุฑุฃ ุงููุฏููุฉ [ููู ูุนูู ุงููุดุฑ ุงููุณุชูุฑุ](Https://huggingface.co/blog/stable_diffusion#how-does-stable-diffusion-work) ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ููููุฉ ุนูู ููุงุฐุฌ VAE ู UNet ููุดูุฑ ุงููุต.

ุงูุขู ุจุนุฏ ุฃู ุนุฑูุช ูุง ุชุญุชุงุฌู ูุฎุท ุฃูุงุจูุจ ุงููุดุฑ ุงููุณุชูุฑุ ูู ุจุชุญููู ุฌููุน ูุฐู ุงูููููุงุช ุจุงุณุชุฎุฏุงู ุทุฑููุฉ [~ ModelMixin.from_pretrained]. ููููู ุงูุนุซูุฑ ุนูููุง ูู ููุทุฉ ุงูุชุญูู ุงููุณุจูุฉ ุงูุชุฏุฑูุจ [runwayml/stable-diffusion-v1-5] (https://huggingface.co/runwayml/stable-diffusion-v1-5)ุ ููุชู ุชุฎุฒูู ูู ูููู ูู ูุฌูุฏ ูุฑุนู ูููุตู:

```py
>>> ูู ุตูุฑุฉ PIL ุงุณุชูุฑุงุฏ ุงูุตูุฑุฉ
>>> ุงุณุชูุฑุงุฏ ุงูุดุนูุฉ
>>> ูู ุงููุญููุงุช ุงุณุชูุฑุงุฏ CLIPTextModelุ CLIPTokenizer
>>> ูู ุงููุงุดุฑูู ุงุณุชูุฑุงุฏ AutoencoderKLุ UNet2DConditionModelุ PNDMScheduler

>>> ูุงู = AutoencoderKL.from_pretrained ("CompVis/stable-diffusion-v1-4"ุ subfolder = "vae"ุ use_safetensors = True)
>>> ูุญุฏุฏ ุงูููุงุถุน = CLIPTokenizer.from_pretrained ("CompVis/stable-diffusion-v1-4"ุ subfolder = "ูุญูู")
>>> ูุดูุฑ ุงููุต = CLIPTextModel.from_pretrained (
... "CompVis/stable-diffusion-v1-4"ุ subfolder = "text_encoder"ุ use_safetensors = True
... )
>>> unet = UNet2DConditionModel.from_pretrained (
... "CompVis/stable-diffusion-v1-4"ุ subfolder = "unet"ุ use_safetensors = True
... )
```

ุจุฏูุงู ูู ุฌุฏูู ุงูููุงุนูุฏ [PNDMScheduler] ุงูุงูุชุฑุงุถูุ ุงุณุชุจุฏูู ุจุฌุฏูู ุงูููุงุนูุฏ [UniPCMultistepScheduler] ููุนุฑูุฉ ูุฏู ุณูููุฉ ุชูุตูู ุฌุฏูู ููุงุนูุฏ ูุฎุชูู:

```py
>>> ูู ุงููุงุดุฑูู ุงุณุชูุฑุงุฏ UniPCMultistepScheduler

>>> ุฌุฏูู ุงูููุงุนูุฏ = UniPCMultistepScheduler.from_pretrained ("CompVis/stable-diffusion-v1-4"ุ subfolder = "ุฌุฏูู ุงูููุงุนูุฏ")
```

ููุฅุณุฑุงุน ูู ุงูุงุณุชุฏูุงูุ ูู ุจููู ุงูููุงุฐุฌ ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ูุธุฑูุง ููุฌูุฏ ุฃูุฒุงู ูุงุจูุฉ ููุชุฏุฑูุจุ ุนูู ุนูุณ ุฌุฏูู ุงูููุงุนูุฏ:

```py
>>> ุฌูุงุฒ ุงูุดุนูุฉ = "cuda"
>>> ูุงู. ุฅูู (ุฌูุงุฒ ุงูุดุนูุฉ)
>>> ูุดูุฑ ุงููุต. ุฅูู (ุฌูุงุฒ ุงูุดุนูุฉ)
>>> unet. ุฅูู (ุฌูุงุฒ ุงูุดุนูุฉ)
```

### ุฅูุดุงุก ุชุถูููุงุช ูุตูุฉ

ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชูููููุฒ ุงููุต ูุชูููุฏ ุงูุชุถูููุงุช. ูุชู ุงุณุชุฎุฏุงู ุงููุต ูุชูููู ูููุฐุฌ UNet ูุชูุฌูู ุนูููุฉ ุงููุดุฑ ูุญู ุดูุก ูุดุจู ููุฌู ุงููุต.

๐ก ูุญุฏุฏ ูุนููุฉ "ูููุงุณ ุงูุชูุฌูู" ููุฏุงุฑ ุงููุฒู ุงูุฐู ูุฌุจ ููุญู ููููุฌู ุนูุฏ ุฅูุดุงุก ุตูุฑุฉ.

ูุง ุชุชุฑุฏุฏ ูู ุงุฎุชูุงุฑ ุฃู ููุฌู ุชุฑูุฏู ุฅุฐุง ููุช ุชุฑูุฏ ุฅูุดุงุก ุดูุก ุขุฎุฑ!

```py
>>> ููุฌู = ["ุตูุฑุฉ ููุชูุบุฑุงููุฉ ูุฑุงุฆุฏ ูุถุงุก ูุฑูุจ ุญุตุงููุง"]
>>> ุงูุงุฑุชูุงุน = 512 # ุงุฑุชูุงุน ุงููุดุฑ ุงููุณุชูุฑ ุงูุงูุชุฑุงุถู
>>> ุงูุนุฑุถ = 512 # ุนุฑุถ ุงููุดุฑ ุงููุณุชูุฑ ุงูุงูุชุฑุงุถู
>>> ุนุฏุฏ ุฎุทูุงุช ุงูุงุณุชุฏูุงู = 25 # ุนุฏุฏ ุฎุทูุงุช ุฅุฒุงูุฉ ุงูุถูุถุงุก
>>> ูููุงุณ ุงูุชูุฌูู = 7.5 # ูููุงุณ ุงูุชูุฌูู ุฎุงูู ูู ุงูุชุตููู
>>> ุงููููุฏ = ุงูุดุนูุฉ. seed () # Seed generator ูุฅูุดุงุก ุงูุถูุถุงุก ุงูุฃูููุฉ
>>> ุญุฌู ุงูุฏูุนุฉ = len (prompt)
```

ูู ุจุชูููููุฒ ุงููุต ูุฅูุดุงุก ุงูุชุถูููุงุช ูู ุงูููุฌู:

```py
>>> ูุต ุงูุฅุฏุฎุงู = ูุญุฏุฏ ุงูููุงุถุน (
... ููุฌูุ ูุณุงุฏุฉ = "ุทูู ุฃูุตู"ุ ุทูู ุฃูุตู = ูุญุฏุฏ ุงูููุงุถุน. model_max_lengthุ truncation = Trueุ return_tensors = "pt"
... )

>>> ูุน ุงูุดุนูุฉ. ูุง_grad ():
... ุงูุชุถูููุงุช ุงููุตูุฉ = ูุดูุฑ ุงููุต (ูุต ุงูุฅุฏุฎุงู. input_ids.to (ุฌูุงุฒ ุงูุดุนูุฉ)) [0]
```

ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅูุดุงุก *ุชุถูููุงุช ุงููุต ุบูุฑ ุงููุดุฑูุทุฉ* ูุงูุชู ุชููู ุงูุชุถูููุงุช ุงูุฎุงุตุฉ ุจุฑูุฒ ุงูุญุดู. ูุฌุจ ุฃู ูููู ููุฐู ุงูุฃุจุนุงุฏ ููุณูุง ("ุญุฌู ุงูุฏูุนุฉ" ู "ุทูู ุงูุชุณูุณู") ูุซู ุงูุชุถูููุงุช ุงููุดุฑูุทุฉ:

```py
>>> ุงูุทูู ุงูุฃูุตู = ูุต ุงูุฅุฏุฎุงู. ุดูู input_ids [-1]
>>> ุฅุฏุฎุงู ุบูุฑ ูุดุฑูุท = ูุญุฏุฏ ุงูููุงุถุน ([""] * ุญุฌู ุงูุฏูุนุฉุ ูุณุงุฏุฉ = "ุทูู ุฃูุตู"ุ ุทูู ุฃูุตู = ุงูุทูู ุงูุฃูุตูุ return_tensors = "pt")
>>> ุงูุชุถูููุงุช ุบูุฑ ุงููุดุฑูุทุฉ = ูุดูุฑ ุงููุต (ุฅุฏุฎุงู ุบูุฑ ูุดุฑูุท. input_ids.to (ุฌูุงุฒ ุงูุดุนูุฉ)) [0]
```

ุฏุนูุง ูููู ุจุฏูุฌ ุงูุชุถูููุงุช ุงููุดุฑูุทุฉ ูุบูุฑ ุงููุดุฑูุทุฉ ูู ุฏูุนุฉ ูุชุฌูุจ ุฅุฌุฑุงุก ุชูุฑูุฑูู:

```py
>>> ุงูุชุถูููุงุช ุงููุตูุฉ = ุงูุดุนูุฉ. cat ([ุงูุชุถูููุงุช ุบูุฑ ุงููุดุฑูุทุฉุ ุงูุชุถูููุงุช ุงููุตูุฉ])
```
### ุฅูุดุงุก ุถูุถุงุก ุนุดูุงุฆูุฉ

ุจุนุฏ ุฐููุ ูู ุจุชูููุฏ ุจุนุถ ุงูุถูุถุงุก ุงูุนุดูุงุฆูุฉ ุงูุฃูููุฉ ูููุทุฉ ุจุฏุงูุฉ ูุนูููุฉ ุงูุงูุชุดุงุฑ. ูุฐุง ูู ุงูุชูุซูู ุงููุงูู ููุตูุฑุฉุ ูุณูุชู ุฅุฒุงูุฉ ุชุดููุดู ุชุฏุฑูุฌููุง. ูู ูุฐู ุงููุฑุญูุฉุ ุชููู ุงูุตูุฑุฉ ุงููุงููุฉ ุฃุตุบุฑ ูู ุญุฌู ุงูุตูุฑุฉ ุงูููุงุฆูุ ูููู ูุฐุง ุฃูุฑ ุทุจูุนู ูุฃู ุงููููุฐุฌ ุณูุญูููุง ูุงุญููุง ุฅูู ุฃุจุนุงุฏ ุงูุตูุฑุฉ ุงูููุงุฆูุฉ 512x512.

<Tip>

๐ก ูุชู ุชูุณูู ุงูุงุฑุชูุงุน ูุงูุนุฑุถ ุนูู 8 ูุฃู ูููุฐุฌ "vae" ูุฏูู 3 ุทุจูุงุช ูุชุฎููุถ ุงูุนููุงุช. ููููู ุงูุชุญูู ูู ุฐูู ุนู ุทุฑูู ุชุดุบูู ูุง ููู:

2 ** (len(vae.config.block_out_channels) - 1) == 8

</Tip>

```py
>>> latents = torch.randn(
...     (batch_size, unet.config.in_channels, height // 8, width // 8),
...     generator=generator,
...     device=torch_device,
... )
```

### ุฅุฒุงูุฉ ุชุดููุด ุงูุตูุฑุฉ

ุงุจุฏุฃ ุจุชุญุฌูู ุงูุฅุฏุฎุงู ูุน ุชูุฒูุน ุงูุถูุถุงุก ุงูุฃูููุฉุ *sigma*ุ ููููุฉ ูููุงุณ ุงูุถูุถุงุกุ ูุงูุชู ุชููู ูุทููุจุฉ ููุฎุทุทุงุช ุงูุชุญุณูู ุงููุญุณููุฉ ูุซู [`UniPCMultistepScheduler`]:

```py
>>> latents = latents * scheduler.init_noise_sigma
```

ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุฅูุดุงุก ุญููุฉ ุฅุฒุงูุฉ ุงูุชุดููุด ุงูุชู ุณุชุญูู ุงูุถูุถุงุก ุงูุจุญุชุฉ ูู "latents" ุฅูู ุตูุฑุฉ ููุตููุฉ ุจูุงุณุทุฉ ููุฌูู ุชุฏุฑูุฌููุง. ุชุฐูุฑุ ุชุญุชุงุฌ ุญููุฉ ุฅุฒุงูุฉ ุงูุชุดููุด ุฅูู ุงูููุงู ุจุซูุงุซุฉ ุฃุดูุงุก:

1. ูู ุจุชุนููู ุฎุทูุงุช ุงูููุช ุงูุชู ูุณุชุฎุฏููุง ุงููุฎุทุท ุฃุซูุงุก ุฅุฒุงูุฉ ุงูุชุดููุด.
2. ูู ุจุงูุชุนููู ุนูู ุฎุทูุงุช ุงูููุช.
3. ูู ูู ุฎุทูุฉ ุฒูููุฉุ ูู ุจุงูุงุชุตุงู ุจูููุฐุฌ UNet ููุชูุจุค ุจุจูุงูุง ุงูุถูุถุงุก ููุฑุฑูุง ุฅูู ุงููุฎุทุท ูุญุณุงุจ ุงูุนููุฉ ุงููุดูุดุฉ ุงูุณุงุจูุฉ.

```py
>>> from tqdm.auto import tqdm

>>> scheduler.set_timesteps(num_inference_steps)

>>> for t in tqdm(scheduler.timesteps):
...     # ูู ุจุชูุณูุน latents ุฅุฐุง ููุง ูููู ุจุงูุฅุฑุดุงุฏ ุงูุฎุงูู ูู ุงูุชุตููู ูุชุฌูุจ ุฅุฌุฑุงุก ุชูุฑูุฑูู ููุฃูุงู.
...     latent_model_input = torch.cat([latents] * 2)

...     latent_model_input = scheduler.scale_model_input(latent_model_input, timestep=t)

...     # ุงูุชูุจุค ุจุจูุงูุง ุงูุถูุถุงุก
...     ูุน torch.no_grad():
...         noise_pred = unet(latent_model_input, t, encoder_hidden_states=text_embeddings).sample

...     # ุฃุฏุงุก ุงูุฅุฑุดุงุฏ
...     noise_pred_uncond, noise_pred_text = noise_pred.chunk(2)
...     noise_pred = noise_pred_uncond + guidance_scale * (noise_pred_text - noise_pred_uncond)

...     # ุงุญุณุจ ุงูุนููุฉ ุงููุดูุดุฉ ุงูุณุงุจูุฉ x_t -> x_t-1
...     latents = scheduler.step(noise_predุ tุ latents).prev_sample
```

### ูู ุชุดููุฑ ุงูุตูุฑุฉ

ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุงุณุชุฎุฏุงู "vae" ูุชุฑููุฒ ุงูุชูุซูู ุงููุงูู ูู ุตูุฑุฉ ูุงูุญุตูู ุนูู ุงูุฅุฎุฑุงุฌ ุงููุดูุฑ ุจุงุณุชุฎุฏุงู "sample":

```py
# ุชุญุฌูู ููู ุชุดููุฑ ุตูุฑุฉ latents ุจุงุณุชุฎุฏุงู vae
latents = 1 / 0.18215 * latents
ูุน torch.no_grad():
image = vae.decode(latents).sample
```

ุฃุฎูุฑูุงุ ูู ุจุชุญููู ุงูุตูุฑุฉ ุฅูู `PIL.Image` ููุดุงูุฏุฉ ุงูุตูุฑุฉ ุงูุชู ุชู ุฅูุดุงุคูุง!

```py
>>> image = (image / 2 + 0.5).clamp(0, 1).squeeze()
>>> image = (image.permute(1, 2, 0) * 255).to(torch.uint8).cpu().numpy()
>>> image = Image.fromarray(image)
>>> image
```

<div class="flex justify-center">
<img src="https://huggingface.co/blog/assets/98_stable_diffusion/stable_diffusion_k_lms.png"/>
</div>

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

ูู ุงูุฃูุงุจูุจ ุงูุฃุณุงุณูุฉ ุฅูู ุงููุนูุฏุฉุ ุฑุฃูุช ุฃู ูู ูุง ุชุญุชุงุฌู ุญููุง ููุชุงุจุฉ ูุธุงู ุงูุชุดุงุฑ ุฎุงุต ุจู ูู ุญููุฉ ุฅุฒุงูุฉ ุงูุชุดููุด. ูุฌุจ ุฃู ุชููู ุงูุญููุฉ ุจุชุนููู ุฎุทูุงุช ุงูููุช ูููุฎุทุทุ ูุงูุชุนููู ุนูููุงุ ูุงูุชุจุฏูู ุจูู ุงุณุชุฏุนุงุก ูููุฐุฌ UNet ููุชูุจุค ุจุจูุงูุง ุงูุถูุถุงุก ููุฑูุฑู ุฅูู ุงููุฎุทุท ูุญุณุงุจ ุงูุนููุฉ ุงููุดูุดุฉ ุงูุณุงุจูุฉ.

ูุฐุง ูู ุงูุบุฑุถ ุงูุญูููู ูู ๐งจ Diffusers: ุฌุนููุง ุจุฏูููุฉ ูุณููุฉ ููุชุงุจุฉ ูุธุงู ุงูุชุดุงุฑ ุฎุงุต ุจู ุจุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุงููุฎุทุทุงุช.

ูู ุงูุฎุทูุงุช ุงูุชุงููุฉุ ูุง ุชุชุฑุฏุฏ ูู:

* ุชุนูู ููููุฉ [ุจูุงุก ูุงููุณุงููุฉ ูู ุฎุท ุฃูุงุจูุจ](../using-diffusers/contribute_pipeline) ุฅูู ๐งจ Diffusers. ูุง ูููููุง ุงูุงูุชุธุงุฑ ูุฑุคูุฉ ูุง ุณูู ุชุฃุชู ุจู!
* ุงุณุชูุดุงู [ุฎุทูุท ุงูุฃูุงุจูุจ ุงูููุฌูุฏุฉ](../api/pipelines/overview) ูู ุงูููุชุจุฉุ ูุงูุธุฑ ูุง ุฅุฐุง ูุงู ุจุฅููุงูู ุชูููู ูุจูุงุก ุฎุท ุฃูุงุจูุจ ูู ุงูุตูุฑ ุจุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุงููุฎุทุทุงุช ุจุดูู ูููุตู.