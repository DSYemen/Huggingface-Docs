
# تكييف نموذج لمهمة جديدة

تتشارك العديد من أنظمة الانتشار في نفس المكونات، مما يتيح لك تكييف نموذج مُدرب مسبقًا لمهمة ما مع مهمة مختلفة تمامًا. سوف يُريك هذا الدليل كيفية تكييف نموذج مُدرب مسبقًا للنص إلى الصورة للرتوش عن طريق تهيئة وتعديل تصميم نموذج [`UNet2DConditionModel`] مُدرب مسبقًا.

## تكوين معلمات UNet2DConditionModel

يقبل [`UNet2DConditionModel`] بشكل افتراضي 4 قنوات في [عينة الإدخال](https://huggingface.co/docs/diffusers/v0.16.0/en/api/models#diffusers.UNet2DConditionModel.in_channels). على سبيل المثال، قم بتحميل نموذج مُدرب مسبقًا للنص إلى الصورة مثل [`runwayml/stable-diffusion-v1-5`](https://huggingface.co/runwayml/stable-diffusion-v1-5) وانظر إلى عدد `in_channels`:

```py
# لا تترجم هذا الكود البرمجي
```

يتطلب الرتوش 9 قنوات في عينة الإدخال. يمكنك التحقق من هذه القيمة في نموذج رتوش مُدرب مسبقًا مثل [`runwayml/stable-diffusion-inpainting`](https://huggingface.co/runwayml/stable-diffusion-inpainting):

```py
# لا تترجم هذا الكود البرمجي
```

لتكييف نموذج النص إلى الصورة للرتوش، ستحتاج إلى تغيير عدد `in_channels` من 4 إلى 9. قم بتهيئة [`UNet2DConditionModel`] بأوزان النموذج المُدرب مسبقًا للنص إلى الصورة، وقم بتغيير `in_channels` إلى 9. يعني تغيير عدد `in_channels` أنه يتعين عليك تعيين `ignore_mismatched_sizes=True` و`low_cpu_mem_usage=False` لتجنب حدوث خطأ عدم تطابق الحجم لأن الشكل مختلف الآن.

```py
# لا تترجم هذا الكود البرمجي
```

يتم تهيئة الأوزان المُدربة مسبقًا للمكونات الأخرى من نموذج النص إلى الصورة من نقاط التفتيش الخاصة بها، ولكن يتم تهيئة أوزان قناة الإدخال (`conv_in.weight`) لـ `unet` بشكل عشوائي. من المهم ضبط دقة النموذج للرتوش؛ وإلا فإن النموذج سيعيد الضوضاء.