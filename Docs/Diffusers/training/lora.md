ุจุงูุชุฃููุฏ! ูููุง ููู ุชุฑุฌูุฉ ูููุต ุงูููุฌูุฏ ูู ุงูููุฑุงุช ูุงูุนูุงููู ุจุงููุบุฉ ุงูุนุฑุจูุฉ:

# LoRA

ุชุนุฏ LoRA (Low-Rank Adaptation of Large Language Models) ุชูููุฉ ุชุฏุฑูุจ ุฎูููุฉ ุงููุฒู ูุดุงุฆุนุฉ ุงูุงุณุชุฎุฏุงู ุชููู ุจุดูู ูุจูุฑ ูู ุนุฏุฏ ุงููุนููุงุช ุงููุงุจูุฉ ููุชุฏุฑูุจ. ุชุนูู ุนู ุทุฑูู ุฅุฏุฎุงู ุนุฏุฏ ุฃูู ูู ุงูุฃูุฒุงู ุงูุฌุฏูุฏุฉ ูู ุงููููุฐุฌ ูุชุฏุฑูุจ ูุฐู ุงูุฃูุฒุงู ููุท. ูุฌุนู ูุฐุง ุงูุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู LoRA ุฃุณุฑุน ุจูุซูุฑุ ูุฃูุซุฑ ููุงุกุฉ ูู ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉุ ูููุชุฌ ุฃูุฒุงู ูููุฐุฌ ุฃุตุบุฑ (ุจุถุน ูุฆุงุช ูู ุงูููุบุงุจุงูุช)ุ ูุงูุชู ูุณูู ุชุฎุฒูููุง ููุดุงุฑูุชูุง. ูููู ุฃูุถูุง ุฏูุฌ LoRA ูุน ุชูููุงุช ุงูุชุฏุฑูุจ ุงูุฃุฎุฑู ูุซู DreamBooth ูุชุณุฑูุน ุงูุชุฏุฑูุจ.

ุชุชูุชุน LoRA ุจูุฑููุฉ ูุจูุฑุฉ ูุชุฏุนููุง ููุชุจุงุช ูุซู DreamBooth ูKandinsky 2.2 ูStable Diffusion XL ูtext-to-image ูWuerstchen.

ุณูุชุนูู ูุฐุง ุงูุฏููู ูู ุฏุฑุงุณุฉ ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ train_text_to_image_lora.py ููุณุงุนุฏุชู ุนูู ุงูุชุนุฑู ุนููู ุจุดูู ุฃูุถูุ ูููู ููููู ุชููููู ูุน ุญุงูุชู ุงูุงุณุชุฎุฏุงููุฉ ุงูุฎุงุตุฉ.

ูุจู ุชุดุบูู ุงููุต ุงูุจุฑูุฌูุ ุชุฃูุฏ ูู ุชุซุจูุช ุงูููุชุจุฉ ูู ุงููุตุฏุฑ:

ูู ุจุงูุชููู ุฅูู ูุฌูุฏ ุงููุซุงู ุงูุฐู ูุญุชูู ุนูู ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ ููู ุจุชุซุจูุช ุงูุชุจุนูุงุช ุงููุทููุจุฉ ูููุต ุงูุจุฑูุฌู ุงูุฐู ุชุณุชุฎุฏูู:

๐ค Accelerate ูู ููุชุจุฉ ุชุณุงุนุฏู ุนูู ุงูุชุฏุฑูุจ ุนูู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (GPU) / ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณูููุงุช (TPU) ุฃู ุจุงุณุชุฎุฏุงู ุงูุฏูุฉ ุงููุฎุชูุทุฉ. ุณูููู ุชููุงุฆููุง ุจุชูููู ุฅุนุฏุงุฏ ุงูุชุฏุฑูุจ ุงูุฎุงุต ุจู ุจูุงุกู ุนูู ุฃุฌูุฒุชู ูุจูุฆุชู. ุงูู ูุธุฑุฉ ุนูู ุงูุฌููุฉ ุงูุณุฑูุนุฉ ูู ๐ค Accelerate ููุนุฑูุฉ ุงููุฒูุฏ.

ูู ุจุชููุฆุฉ ุจูุฆุฉ ๐ค Accelerate:

ูุฅุนุฏุงุฏ ุจูุฆุฉ ๐ค Accelerate ุงูุงูุชุฑุงุถูุฉ ุฏูู ุงุฎุชูุงุฑ ุฃู ุชููููุงุช:

ุฃู ุฅุฐุง ูู ูุฏุนู ุจูุฆุชู ุบูุงููุง ุชูุงุนูููุงุ ูุซู ุฏูุชุฑ ุงูููุงุญุธุงุชุ ูููููู ุงุณุชุฎุฏุงู ูุง ููู:

ุฃุฎูุฑูุงุ ุฅุฐุง ููุช ุชุฑูุฏ ุชุฏุฑูุจ ูููุฐุฌ ุนูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุ ูุฑุงุฌุน ุฏููู ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ููุชุฏุฑูุจ ููุนุฑูุฉ ููููุฉ ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ุชุนูู ูุน ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ.

ุชุณูุท ุงูุฃูุณุงู ุงูุชุงููุฉ ุงูุถูุก ุนูู ุฃุฌุฒุงุก ูู ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ ูุงูุชู ุชูุนุฏ ูููุฉ ูููู ููููุฉ ุชุนุฏูููุงุ ูููููุง ูุง ุชุบุทู ูู ุฌุงูุจ ูู ุฌูุงูุจ ุงููุต ุงูุจุฑูุฌู ุจุงูุชูุตูู. ุฅุฐุง ููุช ููุชููุง ุจูุนุฑูุฉ ุงููุฒูุฏุ ููุง ุชุชุฑุฏุฏ ูู ูุฑุงุกุฉ ุงููุต ุงูุจุฑูุฌู ูุฅุฎุจุงุฑูุง ุฅุฐุง ูุงูุช ูุฏูู ุฃู ุฃุณุฆูุฉ ุฃู ูุฎุงูู.

## ูุนููุงุช ุงููุต ุงูุจุฑูุฌู

ูุญุชูู ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ ุนูู ุงูุนุฏูุฏ ูู ุงููุนููุงุช ููุณุงุนุฏุชู ุนูู ุชุฎุตูุต ุนูููุฉ ุชุดุบูู ุงูุชุฏุฑูุจ. ูููู ุงูุนุซูุฑ ุนูู ุฌููุน ุงููุนููุงุช ููุตูุงุชูุง ูู ูุธููุฉ parse_args(). ูุชู ุชูููุฑ ุงูููู ุงูุงูุชุฑุงุถูุฉ ููุนุธู ุงููุนููุงุช ูุงูุชู ุชุนูู ุจุดูู ุฌูุฏ ุฅูู ุญุฏ ูุงุ ูููู ููููู ุฃูุถูุง ุชุนููู ูููู ุงูุฎุงุตุฉ ูู ุฃูุฑ ุงูุชุฏุฑูุจ ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู.

ุนูู ุณุจูู ุงููุซุงูุ ูุฒูุงุฏุฉ ุนุฏุฏ ุญูุจุงุช ุงูุชุฏุฑูุจ:

ุชู ูุตู ุงูุนุฏูุฏ ูู ุงููุนููุงุช ุงูุฃุณุงุณูุฉ ูุงููููุฉ ูู ุฏููู ุชุฏุฑูุจ text-to-imageุ ูุฐูู ูุฑูุฒ ูุฐุง ุงูุฏููู ููุท ุนูู ุงููุนููุงุช ุฐุงุช ุงูุตูุฉ ุจู LoRA:

- 'rank': ุงูุจุนุฏ ุงูุฏุงุฎูู ููุตูููุงุช ุงูุฑุชุจุฉ ุงูููุฎูุถุฉ ุงูุชู ุณูุชู ุชุฏุฑูุจูุงุ ุชุนูู ุงูุฑุชุจุฉ ุงูุฃุนูู ุนุฏุฏูุง ุฃูุจุฑ ูู ุงููุนููุงุช ุงููุงุจูุฉ ููุชุฏุฑูุจ
- 'learning_rate': ูุนุฏู ุงูุชุนูู ุงูุงูุชุฑุงุถู ูู 1e-4ุ ูููู ูุน LoRAุ ููููู ุงุณุชุฎุฏุงู ูุนุฏู ุชุนูู ุฃุนูู

## ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ

ูููู ุงูุนุซูุฑ ุนูู ููุฏ ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ููุฌููุนุฉ ุงูุจูุงูุงุช ูุญููุฉ ุงูุชุฏุฑูุจ ูู ูุธููุฉ main()ุ ูุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชูููู ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจุ ููุฐุง ูู ุงูููุงู ุงูุฐู ุณุชุฌุฑู ููู ุชุบููุฑุงุชู.

ููุง ูู ุงูุญุงู ูุน ูุนููุงุช ุงููุต ุงูุจุฑูุฌูุ ูุชู ุชูููุฑ ุฏููู ุชูุตููู ููุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ ูู ุฏููู ุชุฏุฑูุจ text-to-image. ุจุฏูุงู ูู ุฐููุ ูููู ูุฐุง ุงูุฏููู ูุธุฑุฉ ุนูู ุฃุฌุฒุงุก ุงููุต ุงูุจุฑูุฌู ุฐุงุช ุงูุตูุฉ ุจู LoRA.

ูุณุชุฎุฏู Diffusers [~ peft.LoraConfig] ูู ููุชุจุฉ PEFT ูุชุญุฏูุฏ ูุนููุงุช ูุญูู LoRA ูุซู ุงูุฑุชุจุฉ ูุงูุฃููุง ูุงููุญุฏุงุช ุงูููุทูุฉ ุงูุชู ุณูุชู ุฅุฏุฑุงุฌ ุฃูุฒุงู LoRA ูููุง. ูุชู ุฅุถุงูุฉ ุงููุญูู ุฅูู UNetุ ููุชู ุชุตููุฉ ุทุจูุงุช LoRA ููุท ููุชุญุณูู ูู 'lora_layers'.

ุชุถูู Diffusers ุฃูุถูุง ุฏุนููุง ูุชุฏุฑูุจ ูุญูู LoRA ูู ููุชุจุฉ PEFT ุนูู ูุดูุฑ ุงููุต ุนูุฏ ุงูุถุฑูุฑุฉุ ูุซู ุชุฏุฑูุจ Stable Diffusion XL (SDXL). ูุชู ุงุณุชุฎุฏุงู [~ peft.LoraConfig] ูุชูููู ูุนููุงุช ูุญูู LoRA ูุงูุชู ูุชู ุจุนุฏ ุฐูู ุฅุถุงูุชูุง ุฅูู ูุดูุฑ ุงููุตุ ููุชู ุชุตููุฉ ุทุจูุงุช LoRA ููุท ููุชุฏุฑูุจ.

ูุชู ุชููุฆุฉ ุงููุญุณู ุจุงุณุชุฎุฏุงู 'lora_layers' ูุฃู ูุฐู ูู ุงูุฃูุฒุงู ุงููุญูุฏุฉ ุงูุชู ุณูุชู ุชุญุณูููุง:

ุจุงุณุชุซูุงุก ุฅุนุฏุงุฏ ุทุจูุงุช LoRAุ ูุฅู ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ ูู ููุณู ุชูุฑูุจูุง ูุซู train_text_to_image.py!

## ุฅุทูุงู ุงููุต ุงูุจุฑูุฌู

ุจูุฌุฑุฏ ุฅุฌุฑุงุก ุฌููุน ุงูุชุบููุฑุงุช ุฃู ุฅุฐุง ููุช ุฑุงุถููุง ุนู ุงูุชูููู ุงูุงูุชุฑุงุถูุ ูุฃูุช ูุณุชุนุฏ ูุฅุทูุงู ูุต ุงูุจุฑูุฌุฉ ุงููุตูุฉ ููุชุฏุฑูุจ! ๐

ุฏุนููุง ูุชุฏุฑุจ ุนูู ูุฌููุนุฉ ุจูุงูุงุช Naruto BLIP captions ูุฅูุดุงุก ุดุฎุตูุงุช ูุงุฑูุชู ุงูุฎุงุตุฉ ุจู. ูู ุจุชุนููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ MODEL_NAME ูOUTPUT_DIR ูHUB_MODEL_ID ูDATASET_NAME ุฅูู ุงููููุฐุฌ ููุฌููุนุฉ ุงูุจูุงูุงุช ูููุนุฑู ุงููููุฐุฌ ุนูู Hubุ ุนูู ุงูุชูุงูู. ูููู ุงููุต ุงูุจุฑูุฌู ุจุฅูุดุงุก ูุญูุธ ุงููููุงุช ุงูุชุงููุฉ ูู ุงููุณุชูุฏุน ุงูุฎุงุต ุจู:

- ููุงุท ุงูุชุญูู ูููููุฐุฌ ุงููุญููุธุฉ
- pytorch_lora_weights.safetensors (ุฃูุฒุงู LoRA ุงููุฏุฑุจุฉ)

ุฅุฐุง ููุช ุชุชุฏุฑุจ ุนูู ุฃูุซุฑ ูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณููุงุช (GPU)ุ ูุฃุถู ุงููุนููุฉ --multi_gpu ุฅูู ุฃูุฑ accelerate launch.

ูุณุชุบุฑู ุชุดุบูู ุงูุชุฏุฑูุจ ุงููุงูู ~5 ุณุงุนุงุช ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) 2080 Ti ูุน 11 ุฌูุฌุงุจุงูุช ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงูุฏููุงูููู (VRAM).

ุจูุฌุฑุฏ ุงูุงูุชูุงุก ูู ุงูุชุฏุฑูุจุ ููููู ุงุณุชุฎุฏุงู ูููุฐุฌู ููุงุณุชูุชุงุฌ:

ุขูู ุฃู ุชููู ูุฐู ุงูุชุฑุฌูุฉ ูุงุถุญุฉ ููููุฏุฉ! ูุง ุชุชุฑุฏุฏ ูู ุงูุณุคุงู ุฅุฐุง ูุงูุช ููุงู ุฃู ููุงุท ุชุญุชุงุฌ ุฅูู ูุฒูุฏ ูู ุงูุชูุถูุญ.
## ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุชูุงูููุง ุนูู ุชุฏุฑูุจ ูููุฐุฌ ุฌุฏูุฏ ุจุงุณุชุฎุฏุงู LoRA! ููุชุนุฑู ุฃูุซุฑ ุนูู ููููุฉ ุงุณุชุฎุฏุงู ูููุฐุฌู ุงูุฌุฏูุฏุ ูุฏ ุชููู ุงูุฃุฏูุฉ ุงูุชุงููุฉ ูููุฏุฉ:

- ุชุนูู ููููุฉ [ุชุญููู ุชูุณููุงุช LoRA ุงููุฎุชููุฉ](../using-diffusers/loading_adapters#LoRA) ุงูุชู ุชู ุชุฏุฑูุจูุง ุจุงุณุชุฎุฏุงู ูุฏุฑุจูู ูู ุงููุฌุชูุน ูุซู ููููุง ูุฐุง ูุงุณุช ุจู.

- ุชุนูู ููููุฉ ุงุณุชุฎุฏุงู ู [ุฏูุฌ ุนุฏุฉ ููุงุฐุฌ LoRA](../tutorials/using_peft_for_inference) ูุน PEFT ูู ุฃุฌู ุงูุงุณุชูุชุงุฌ.