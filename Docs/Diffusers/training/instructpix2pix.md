ุจุงูุชุฃููุฏุ ุณุฃูุชุฒู ุจุงูุชุนูููุงุช ุงููุฐููุฑุฉ. ูููุง ููู ุชุฑุฌูุฉ ููููุฑุงุช ูุงูุนูุงููู ุงูููุฌูุฏุฉ ูู ุงููุต ุงููุญุฏุฏ:

# InstructPix2Pix

InstructPix2Pix ูู ูููุฐุฌ Stable Diffusion ุชู ุชุฏุฑูุจู ูุชุนุฏูู ุงูุตูุฑ ุจูุงุกู ุนูู ุชุนูููุงุช ุจุดุฑูุฉ. ุนูู ุณุจูู ุงููุซุงูุ ูููู ุฃู ูููู ููุฌูู "ุงุฌุนู ุงูุณุญุจ ููุทุฑุฉ" ูุณูููู ุงููููุฐุฌ ุจุชุนุฏูู ุตูุฑุฉ ุงูุฅุฏุฎุงู ููููุง ูุฐูู. ูุฐุง ุงููููุฐุฌ ูุดุฑูุท ุจูุต ุงูุฅุฑุดุงุฏุงุช (ุฃู ุชุนูููุงุช ุงูุชุนุฏูู) ูุตูุฑุฉ ุงูุฅุฏุฎุงู.

ุณูุชุนูู ูุฐุง ุงูุฏููู ูู ุฏุฑุงุณุฉ ูุต ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ train_instruct_pix2pix.py ููุณุงุนุฏุชู ุนูู ุงูุชุนุฑู ุนูููุ ูููู ููููู ุชููููู ูุน ุญุงูุชู ุงูุงุณุชุฎุฏุงู ุงูุฎุงุตุฉ.

ูุจู ุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตูุ ุชุฃูุฏ ูู ุชุซุจูุช ุงูููุชุจุฉ ูู ุงููุตุฏุฑ:

ุงูุชูู ุฅูู ูุฌูุฏ ุงููุซุงู ุงูุฐู ูุญุชูู ุนูู ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ ููู ุจุชุซุจูุช ุงูุชุจุนูุงุช ุงููุทููุจุฉ ููุจุฑูุงูุฌ ุงููุตู ุงูุฐู ุชุณุชุฎุฏูู:

๐ค Accelerate ูู ููุชุจุฉ ุชุณุงุนุฏู ุนูู ุงูุชุฏุฑูุจ ุนูู ูุญุฏุงุช GPU/TPU ูุชุนุฏุฏุฉ ุฃู ุจุงุณุชุฎุฏุงู ุงูุฏูุฉ ุงููุฎุชูุทุฉ. ุณูููู ุชููุงุฆููุง ุจุชูููู ุฅุนุฏุงุฏ ุงูุชุฏุฑูุจ ุงูุฎุงุต ุจู ุจูุงุกู ุนูู ุฃุฌูุฒุชู ูุจูุฆุชู. ุงูู ูุธุฑุฉ ุนูู ุงูุฌููุฉ ุงูุณุฑูุนุฉ ูู ๐ค Accelerate ููุนุฑูุฉ ุงููุฒูุฏ.

ูู ุจุชููุฆุฉ ุจูุฆุฉ ๐ค Accelerate:

ูุฅุนุฏุงุฏ ุจูุฆุฉ ๐ค Accelerate ุงูุงูุชุฑุงุถูุฉ ุฏูู ุงุฎุชูุงุฑ ุฃู ุชููููุงุช:

ุฃู ุฅุฐุง ูู ูุฏุนู ุจูุฆุชู ุบูุงููุง ุชูุงุนูููุงุ ูุซู ุฏูุชุฑ ุงูููุงุญุธุงุชุ ูููููู ุงุณุชุฎุฏุงู:

ุฃุฎูุฑูุงุ ุฅุฐุง ููุช ุชุฑูุฏ ุชุฏุฑูุจ ูููุฐุฌ ุนูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุ ูุฑุงุฌุน ุฏููู ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ููุชุฏุฑูุจ ููุนุฑูุฉ ููููุฉ ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ุชุนูู ูุน ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ.

ุชุณูุท ุงูุฃูุณุงู ุงูุชุงููุฉ ุงูุถูุก ุนูู ุฃุฌุฒุงุก ูู ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ ุงููููุฉ ูููู ููููุฉ ุชุนุฏูููุ ููููู ูุง ูุบุทู ูู ุฌุงูุจ ูู ุฌูุงูุจ ุงูุจุฑูุงูุฌ ุงููุตู ุจุงูุชูุตูู. ุฅุฐุง ููุช ููุชููุง ุจูุนุฑูุฉ ุงููุฒูุฏุ ููุง ุชุชุฑุฏุฏ ูู ูุฑุงุกุฉ ุงูุจุฑูุงูุฌ ุงููุตู ูุฏุนูุง ูุนุฑู ุฅุฐุง ูุงู ูุฏูู ุฃู ุฃุณุฆูุฉ ุฃู ูุฎุงูู.

## ูุนููุงุช ุงูุจุฑูุงูุฌ ุงููุตู

ูุญุชูู ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ ุนูู ุงูุนุฏูุฏ ูู ุงููุนููุงุช ููุณุงุนุฏุชู ุนูู ุชุฎุตูุต ุนูููุฉ ุงูุชุฏุฑูุจ ุงูุฎุงุตุฉ ุจู. ูููู ุงูุนุซูุฑ ุนูู ุฌููุน ุงููุนููุงุช ููุตูุงุชูุง ูู ุฏุงูุฉ parse_args(). ูุชู ุชูููุฑ ุงูููู ุงูุงูุชุฑุงุถูุฉ ููุนุธู ุงููุนููุงุช ุงูุชู ุชุนูู ุจุดูู ุฌูุฏุ ูููู ููููู ุฃูุถูุง ุชุนููู ูููู ุงูุฎุงุตุฉ ูู ุฃูุฑ ุงูุชุฏุฑูุจ ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฐูู.

ุนูู ุณุจูู ุงููุซุงูุ ูุฒูุงุฏุฉ ุฏูุฉ ุตูุฑุฉ ุงูุฅุฏุฎุงู:

ูุชู ูุตู ุงูุนุฏูุฏ ูู ุงููุนููุงุช ุงูุฃุณุงุณูุฉ ูุงููููุฉ ูู ุฏููู ุงูุชุฏุฑูุจ Text-to-imageุ ูุฐูู ูุฑูุฒ ูุฐุง ุงูุฏููู ููุท ุนูู ุงููุนููุงุช ุฐุงุช ุงูุตูุฉ ุจู InstructPix2Pix:

- --original_image_column: ุงูุตูุฑุฉ ุงูุฃุตููุฉ ูุจู ุฅุฌุฑุงุก ุงูุชุนุฏููุงุช
- --edited_image_column: ุงูุตูุฑุฉ ุจุนุฏ ุฅุฌุฑุงุก ุงูุชุนุฏููุงุช
- --edit_prompt_column: ุชุนูููุงุช ูุชุนุฏูู ุงูุตูุฑุฉ
- --conditioning_dropout_prob: ุงุญุชูุงู ุฅุณูุงุท ุงูุตูุฑุฉ ุงููุนุฏูุฉ ูุฅุณูุงุทุงุช ุงูุฅุฑุดุงุฏุงุช ุฃุซูุงุก ุงูุชุฏุฑูุจ ุงูุฐู ููููู ุงูุชูุฌูู ุงูุฎุงูู ูู ุงูุชุตููู (CFG) ููุงุญุฏ ุฃู ููุง ูู ุฅุฏุฎุงูุงุช ุงูุชูููู

## ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ

ูููู ุงูุนุซูุฑ ุนูู ุฑูุฒ ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ููุฌููุนุฉ ุงูุจูุงูุงุช ูุญููุฉ ุงูุชุฏุฑูุจ ูู ุฏุงูุฉ main(). ููุง ุณุชููู ุจุฅุฌุฑุงุก ุชุบููุฑุงุชู ุนูู ุงูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ ูุชููููู ูุน ุญุงูุชู ุงูุงุณุชุฎุฏุงู ุงูุฎุงุตุฉ.

ููุง ูู ุงูุญุงู ูุน ูุนููุงุช ุงูุจุฑูุงูุฌ ุงููุตูุ ูุชู ุชูููุฑ ุฏููู ุชูุตููู ููุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ ูู ุฏููู ุงูุชุฏุฑูุจ Text-to-image. ุจุฏูุงู ูู ุฐููุ ูููู ูุฐุง ุงูุฏููู ูุธุฑุฉ ุนูู ุฃุฌุฒุงุก ุงูุจุฑูุงูุฌ ุงููุตู ุฐุงุช ุงูุตูุฉ ุจู InstructPix2Pix.

ูุจุฏุฃ ุงูุจุฑูุงูุฌ ุงููุตู ุจุชุนุฏูู ุนุฏุฏ ูููุงุช ุงูุฅุฏุฎุงู ูู ุงูุทุจูุฉ ุงูุชูุงููููุฉ ุงูุฃููู ูุดุจูุฉ UNet ููุฑุงุนุงุฉ ุตูุฑุฉ ุงูุชูููู ุงูุฅุถุงููุฉ ูู InstructPix2Pix:

ูุชู ุชุญุฏูุซ ูุฐู ุงููุนููุงุช ุจูุงุณุทุฉ ุงููุญุณู:

ุจุนุฏ ุฐููุ ูุชู ูุนุงูุฌุฉ ุงูุตูุฑ ุงููุนุฏูุฉ ูุชุนูููุงุช ุงูุชุนุฏูู ูุฑููุฒูุง. ูู ุงูููู ุชุทุจูู ููุณ ุงูุชุญููุงุช ุนูู ุงูุตูุฑ ุงูุฃุตููุฉ ูุงููุนุฏูุฉ.

ุฃุฎูุฑูุงุ ูู ุญููุฉ ุงูุชุฏุฑูุจุ ูุจุฏุฃ ุจุชุดููุฑ ุงูุตูุฑ ุงููุนุฏูุฉ ูู ูุณุงุญุฉ ุฎููุฉ:

ุจุนุฏ ุฐููุ ูููู ุงูุจุฑูุงูุฌ ุงููุตู ุจุชุทุจูู ุงูุฅุณูุงุท ุนูู ุชุถููู ุตูุฑุฉ ุงูุฅุฏุฎุงู ูุชุนูููุงุช ุงูุชุนุฏูู ูุฏุนู CFG. ููููู ูุฐุง ุงููููุฐุฌ ูู ุชุนุฏูู ุชุฃุซูุฑ ุชุนูููุงุช ุงูุชุนุฏูู ูุตูุฑุฉ ุงูุฅุฏุฎุงู ุนูู ุงูุตูุฑุฉ ุงููุนุฏูุฉ.

ูุฐุง ูู ุดูุก! ุจุฎูุงู ุงูุงุฎุชูุงูุงุช ุงูููุถุญุฉ ููุงุ ูุฅู ุจููุฉ ุงูุจุฑูุงูุฌ ุงููุตู ูุดุงุจู ุฌุฏูุง ูุจุฑูุงูุฌ ุงููุตู ููุชุฏุฑูุจ Text-to-imageุ ูุฐุง ูุง ุชุชุฑุฏุฏ ูู ุงูุชุญูู ููู ููุญุตูู ุนูู ูุฒูุฏ ูู ุงูุชูุงุตูู. ุฅุฐุง ููุช ุชุฑูุฏ ูุนุฑูุฉ ุงููุฒูุฏ ุญูู ููููุฉ ุนูู ุญููุฉ ุงูุชุฏุฑูุจุ ูุฑุงุฌุน ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุญูู ููู ุงูุฃูุงุจูุจ ูุงูููุงุฐุฌ ูุงูุฌุฏุงูู ุงูุฒูููุฉ ุงูุฐู ููุณุฑ ุงูููุท ุงูุฃุณุงุณู ูุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก.
## ุชุดุบูู ุงูุณูุฑุจุช 

ุนูุฏูุง ุชููู ุฑุงุถูุงู ุนู ุงูุชุบููุฑุงุช ุงูุชู ุฃุฌุฑูุชูุง ุนูู ุงูุณูุฑุจุช ุฃู ุฅุฐุง ููุช ููุงููุงู ุนูู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉุ ูุฃูุช ูุณุชุนุฏ ูุชุดุบูู ุณูุฑุจุช ุงูุชุฏุฑูุจ! ๐

ูุณุชุฎุฏู ูุฐุง ุงูุฏููู ูุฌููุนุฉ ุงูุจูุงูุงุช [fusing/instructpix2pix-1000-samples](https://huggingface.co/datasets/fusing/instructpix2pix-1000-samples)ุ ูุงูุชู ูู ูุณุฎุฉ ูุตุบุฑุฉ ูู [ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฃุตููุฉ](https://huggingface.co/datasets/timbrooks/instructpix2pix-clip-filtered). ููููู ุฃูุถูุง ุฅูุดุงุก ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู ูุงุณุชุฎุฏุงููุง ุฅุฐุง ุฃุฑุฏุช (ุฑุงุฌุน ุฏููู [ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ููุชุฏุฑูุจ](create_dataset)).

ูู ุจุชุนููู ูุชุบูุฑ ุงูุจูุฆุฉ `MODEL_NAME` ุฅูู ุงุณู ุงููููุฐุฌ (ูููู ุฃู ูููู ูุนุฑู ุงููููุฐุฌ ุนูู Hub ุฃู ูุณุงุฑูุง ุฅูู ูููุฐุฌ ูุญูู)ุ ู`DATASET_ID` ุฅูู ุงุณู ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูู Hub. ูููู ุงูุณูุฑุจุช ุจุฅูุดุงุก ูุญูุธ ุฌููุน ุงูููููุงุช (ูุณุชุฎุฑุฌ ุงูุฎุตุงุฆุตุ ููุฎุทุท ุงูุชุฏุฑุฌุ ููุดูุฑ ุงููุตุ ูUNetุ ููุง ุฅูู ุฐูู) ูู ูุฌูุฏ ูุฑุนู ูู ูุณุชูุฏุนู.

<Tip>

ููุญุตูู ุนูู ูุชุงุฆุฌ ุฃูุถูุ ุฌุฑุจ ุชุดุบููุงุช ุชุฏุฑูุจ ุฃุทูู ูุน ูุฌููุนุฉ ุจูุงูุงุช ุฃูุจุฑ. ููุฏ ูููุง ุจุงุฎุชุจุงุฑ ุณูุฑุจุช ุงูุชุฏุฑูุจ ูุฐุง ุนูู ูุฌููุนุฉ ุจูุงูุงุช ูุตุบุฑุฉ ููุท.

<br>

ููุฑุงูุจุฉ ุชูุฏู ุงูุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู Weights and Biasesุ ุฃุถู ุงููุนุงูู `--report_to=wandb` ุฅูู ุฃูุฑ ุงูุชุฏุฑูุจุ ูุญุฏุฏ ุตูุฑุฉ ุชุญูู ูู ุงูุตุญุฉ ุจุงุณุชุฎุฏุงู `--val_image_url` ูุญุฏุฏ ุฅุดุงุฑุฉ ุชุญูู ูู ุงูุตุญุฉ ุจุงุณุชุฎุฏุงู `--validation_prompt`. ูููู ุฃู ูููู ูุฐุง ูููุฏูุง ุฌุฏูุง ูู ุชุตุญูุญ ุฃุฎุทุงุก ุงููููุฐุฌ.

</Tip>

ุฅุฐุง ููุช ุชููู ุจุงูุชุฏุฑูุจ ุนูู ุฃูุซุฑ ูู ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณูููุฉ (GPU)ุ ูุฃุถู ุงููุนุงูู `--multi_gpu` ุฅูู ุฃูุฑ `accelerate launch`.

```bash
accelerate launch --mixed_precision="fp16" train_instruct_pix2pix.py \
--pretrained_model_name_or_path=$MODEL_NAME \
--dataset_name=$DATASET_ID \
--enable_xformers_memory_efficient_attention \
--resolution=256 \
--random_flip \
--train_batch_size=4 \
--gradient_accumulation_steps=4 \
--gradient_checkpointing \
--max_train_steps=15000 \
--checkpointing_steps=5000 \
--checkpoints_total_limit=1 \
--learning_rate=5e-05 \
--max_grad_norm=1 \
--lr_warmup_steps=0 \
--conditioning_dropout_prob=0.05 \
--mixed_precision=fp16 \
--seed=42 \
--push_to_hub
```

ุจุนุฏ ุงูุชูุงุก ุงูุชุฏุฑูุจุ ููููู ุงุณุชุฎุฏุงู InstructPix2Pix ุงูุฌุฏูุฏ ููุงุณุชูุชุงุฌ:

```py
import PIL
import requests
import torch
from diffusers import StableDiffusionInstructPix2PixPipeline
from diffusers.utils import load_image

pipeline = StableDiffusionInstructPix2PixPipeline.from_pretrained("your_cool_model", torch_dtype=torch.float16).to("cuda")
generator = torch.Generator("cuda").manual_seed(0)

image = load_image("https://huggingface.co/datasets/sayakpaul/sample-datasets/resolve/main/test_pix2pix_4.png")
prompt = "add some ducks to the lake"
num_inference_steps = 20
image_guidance_scale = 1.5
guidance_scale = 10

edited_image = pipeline(
prompt,
image=image,
num_inference_steps=num_inference_steps,
image_guidance_scale=image_guidance_scale,
guidance_scale=guidance_scale,
generator=generator,
).images[0]
edited_image.save("edited_image.png")
```

ูุฌุจ ุนููู ุชุฌุฑุจุฉ ููู ูุฎุชููุฉ ูู `num_inference_steps`ุ ู`image_guidance_scale`ุ ู`guidance_scale` ููุนุฑูุฉ ููู ุชุคุซุฑ ุนูู ุณุฑุนุฉ ุงูุงุณุชูุชุงุฌ ูุงูุฌูุฏุฉ. ูุนููุงุช ูููุงุณ ุงูุชูุฌูู ููุง ุชุฃุซูุฑ ูุจูุฑ ูุฃููุง ุชุชุญูู ูู ูุฏู ุชุฃุซูุฑ ุงูุตูุฑุฉ ุงูุฃุตููุฉ ูุชุนูููุงุช ุงูุชุญุฑูุฑ ุนูู ุงูุตูุฑุฉ ุงููุนุฏูุฉ.

## Stable Diffusion XL

Stable Diffusion XL (SDXL) ูู ูููุฐุฌ ููู ูููุต ุฅูู ุงูุตูุฑุฉ ูููู ุจุชูููุฏ ุตูุฑ ุนุงููุฉ ุงูุฏูุฉุ ููุถูู ูุดูุฑ ูุต ุซุงูู ุฅูู ุชุตูููู. ุงุณุชุฎุฏู ุณูุฑุจุช [`train_instruct_pix2pix_sdxl.py`](https://github.com/huggingface/diffusers/blob/main/examples/instruct_pix2pix/train_instruct_pix2pix_sdxl.py) ูุชุฏุฑูุจ ูููุฐุฌ SDXL ููุชุงุจุนุฉ ุชุนูููุงุช ุชุญุฑูุฑ ุงูุตูุฑ.

ููุงูุด ุฏููู [SDXL training](sdxl) ุณูุฑุจุช ุชุฏุฑูุจ SDXL ุจูุฒูุฏ ูู ุงูุชูุตูู.

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุชูุงูููุง ุนูู ุชุฏุฑูุจ ูููุฐุฌ InstructPix2Pix ุงูุฎุงุต ุจู! ๐ฅณ ููุฒูุฏ ูู ุงููุนูููุงุช ุญูู ุงููููุฐุฌุ ูุฏ ูููู ูู ุงููููุฏ:

- ูุฑุงุกุฉ ููุดูุฑ ุงููุฏููุฉ [Instruction-tuning Stable Diffusion with InstructPix2Pix](https://huggingface.co/blog/instruction-tuning-sd) ููุนุฑูุฉ ุงููุฒูุฏ ุนู ุจุนุถ ุงูุชุฌุงุฑุจ ุงูุชู ุฃุฌุฑููุงูุง ูุน InstructPix2Pixุ ูุฅุนุฏุงุฏ ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูุงููุชุงุฆุฌ ูุชุนูููุงุช ูุฎุชููุฉ.