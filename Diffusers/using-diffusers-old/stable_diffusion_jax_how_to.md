# JAX/Flax

ูุฏุนู ๐ค Diffusers ุงุณุชุฎุฏุงู Flax ููุญุตูู ุนูู ุฃุฏุงุก ุงุณุชุฏูุงู ูุงุฆู ุงูุณุฑุนุฉ ุนูู ูุญุฏุงุช ูุนุงูุฌุฉ TensorFlow (TPUs) ูู Googleุ ูุซู ุชูู ุงููุชููุฑุฉ ูู Colab ุฃู Kaggle ุฃู Google Cloud Platform. ููุธูุฑ ูุฐุง ุงูุฏููู ููููุฉ ุชุดุบูู ุงูุงุณุชุฏูุงู ุจุงุณุชุฎุฏุงู Stable Diffusion ูุน JAX/Flax.

ูุจู ุงูุจุฏุกุ ุชุฃูุฏ ูู ุชุซุจูุช ุงูููุชุจุงุช ุงููุงุฒูุฉ:

```py
# ูู ุจุฅูุบุงุก ุงูุชุนููู ูุชุซุจูุช ุงูููุชุจุงุช ุงููุงุฒูุฉ ูู Colab
#! pip install -q jax==0.3.25 jaxlib==0.3.25 flax transformers ftfy
#! pip install -q diffusers
```

ูุฌุจ ุฃูุถูุง ุงูุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุฎูููุฉ ูุญุฏุฉ ูุนุงูุฌุฉ TensorFlow (TPU). ูู ุญูู ุฃู JAX ูุง ูุนูู ุญุตุฑููุง ุนูู ูุญุฏุงุช ูุนุงูุฌุฉ TensorFlow (TPUs)ุ ูุณุชุญุตู ุนูู ุฃูุถู ุฃุฏุงุก ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ TensorFlow (TPU) ูุฃู ูู ุฎุงุฏู ูุญุชูู ุนูู 8 ูุณุฑุนุงุช ูุญุฏุฉ ูุนุงูุฌุฉ TensorFlow (TPU) ุชุนูู ุจุงูุชูุงุฒู.

ุฅุฐุง ููุช ุชุดุบู ูุฐุง ุงูุฏููู ูู Colabุ ูุญุฏุฏ "Runtime" ูู ุงููุงุฆูุฉ ุฃุนูุงูุ ุซู ุญุฏุฏ ุฎูุงุฑ "Change runtime type"ุ ุซู ุญุฏุฏ "TPU" ุถูู ุฅุนุฏุงุฏ "Hardware accelerator". ูู ุจุงุณุชูุฑุงุฏ JAX ูุงูุชุญูู ุจุณุฑุนุฉ ููุง ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุญุฏุฉ ูุนุงูุฌุฉ TensorFlow (TPU):

```python
import jax
import jax.tools.colab_tpu
jax.tools.colab_tpu.setup_tpu()

num_devices = jax.device_count()
device_type = jax.devices()[0].device_kind

print(f"Found {num_devices} JAX devices of type {device_type}.")
assert (
    "TPU" in device_type,
    "Available device is not a TPU, please select TPU from Runtime > Change runtime type > Hardware accelerator",
)
# ุชู ุงูุนุซูุฑ ุนูู 8 ุฃุฌูุฒุฉ JAX ูู ููุน Cloud TPU.
```

ุงูุขูุ ููููู ุงุณุชูุฑุงุฏ ุจููุฉ ุงูุชุจุนูุงุช ุงูุชู ุณุชุญุชุงุฌูุง:

```python
import jax.numpy as jnp
from jax import pmap
from flax.jax_utils import replicate
from flax.training.common_utils import shard

from diffusers import FlaxStableDiffusionPipeline
```

## ุชุญููู ูููุฐุฌ

Flax ุนุจุงุฑุฉ ุนู ุฅุทุงุฑ ุนูู ูุธูููุ ูุฐูู ูุฅู ุงูููุงุฐุฌ ูุง ุชุญุชูู ุนูู ุญุงูุฉ ูุชุชู ุชุฎุฒูู ุงููุนููุงุช ุฎุงุฑุฌูุง. ูููู ุชุญููู ุฎุท ุฃูุงุจูุจ Flax ุงูููุฏุฑุจ ูุณุจููุง ุจุฅุฑุฌุงุน ูู ูู ุฎุท ุงูุฃูุงุจูุจ ููุฒู ุงููููุฐุฌ (ุฃู ุงููุนููุงุช). ูู ูุฐุง ุงูุฏูููุ ุณุชุณุชุฎุฏู `bfloat16`ุ ููู ููุน ูุตู ุนุงุฆู ุฃูุซุฑ ููุงุกุฉ ุชุฏุนูู ูุญุฏุงุช ูุนุงูุฌุฉ TensorFlow (TPUs) (ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู `float32` ููุญุตูู ุนูู ุฏูุฉ ูุงููุฉ ุฅุฐุง ุฃุฑุฏุช).

```python
dtype = jnp.bfloat16
pipeline, params = FlaxStableDiffusionPipeline.from_pretrained(
    "CompVis/stable-diffusion-v1-4",
    revision="bf16",
    dtype=dtype,
)
```

## ุงูุงุณุชุฏูุงู

ุนุงุฏุฉู ูุง ุชุญุชูู ูุญุฏุงุช ูุนุงูุฌุฉ TensorFlow (TPUs) ุนูู 8 ุฃุฌูุฒุฉ ุชุนูู ุจุงูุชูุงุฒูุ ูุฐุง ุฏุนูุง ูุณุชุฎุฏู ููุณ ุงููุญูุฒ ููู ุฌูุงุฒ. ูุฐุง ูุนูู ุฃูู ููููู ุฅุฌุฑุงุก ุงูุงุณุชุฏูุงู ุนูู 8 ุฃุฌูุฒุฉ ูู ููุณ ุงูููุชุ ูุน ููุงู ูู ุฌูุงุฒ ุจุชูููุฏ ุตูุฑุฉ ูุงุญุฏุฉ. ููุชูุฌุฉ ูุฐููุ ุณุชุญุตู ุนูู 8 ุตูุฑ ูู ููุณ ุงูููุช ุงูุฐู ูุณุชุบุฑูู ุงูุดุฑูุญุฉ ูุชูููุฏ ุตูุฑุฉ ูุงุญุฏุฉ!

<Tip>
ุชุนุฑู ุนูู ุงููุฒูุฏ ูู ุงูุชูุงุตูู ูู ูุณู [ููู ุชุนูู ุงูููุงุฒุงุฉุ](#how-does-parallelization-work).
</Tip>

ุจุนุฏ ุงุณุชูุณุงุฎ ุงููุญูุฒุ ุงุญุตู ุนูู ูุนุฑูุงุช ุงููุต ุงููุนูู ุจุงูุฑููุฒ ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุฏุงูุฉ `prepare_inputs` ุนูู ุฎุท ุงูุฃูุงุจูุจ. ูุชู ุชุนููู ุทูู ุงููุต ุงููุนูู ุจุงูุฑููุฒ ุฅูู 77 ุฑูุฒูุง ููุง ูู ูุทููุจ ูู ุฎูุงู ุชูููู ูููุฐุฌ CLIP ุงููุตู ุงูุฃุณุงุณู.

```python
prompt = "ููุทุฉ ุณูููุงุฆูุฉ ููููู ุนู Morgan Freeman ููุนุจ ุฏูุฑ Jimi Hendrixุ ุตูุฑุฉ ุดุฎุตูุฉุ ุนุฏุณุฉ 40 ููุ ุนูู ุถุญู ููุญููุ ููุทุฉ ูุฑูุจุฉุ ุฅุถุงุกุฉ ูููุณูุฉุ ุณูููุงุฆู"
prompt = [prompt] * jax.device_count()
prompt_ids = pipeline.prepare_inputs(prompt)
prompt_ids.shape
# (8ุ 77)
```

ูุฌุจ ุชูุฑุงุฑ ูุนููุงุช ุงููููุฐุฌ ูุงููุฏุฎูุงุช ุนุจุฑ 8 ุฃุฌูุฒุฉ ูุชูุงุฒูุฉ. ูุชู ุชูุฑุงุฑ ูุงููุณ ุงููุนููุงุช ุจุงุณุชุฎุฏุงู [`flax.jax_utils.replicate`](https://flax.readthedocs.io/en/latest/api_reference/flax.jax_utils.html#flax.jax_utils.replicate) ุงูุฐู ูููู ุจูุญุต ุงููุงููุณ ูุชุบููุฑ ุดูู ุงูุฃูุฒุงู ุจุญูุซ ูุชู ุชูุฑุงุฑูุง 8 ูุฑุงุช. ูุชู ุชูุฑุงุฑ ุงููุตูููุงุช ุจุงุณุชุฎุฏุงู `shard`.

```python
# ุงููุนููุงุช
p_params = replicate(params)

# ุงููุตูููุงุช
prompt_ids = shard(prompt_ids)
prompt_ids.shape
# (8ุ 1ุ 77)
```

ูุนูู ูุฐุง ุงูุดูู ุฃู ูู ุฌูุงุฒ ูู ุงูุฃุฌูุฒุฉ ุงูุซูุงููุฉ ูุณุชูุจู ููุฏุฎู ูุตูููุฉ `jnp` ุฐุงุช ุดูู `(1ุ 77)`ุ ุญูุซ `1` ูู ุญุฌู ุงูุฏูุนุฉ ููู ุฌูุงุฒ. ูู ูุญุฏุงุช ูุนุงูุฌุฉ TensorFlow (TPUs) ุฐุงุช ุงูุฐุงูุฑุฉ ุงููุงููุฉุ ูููู ุฃู ูููู ุญุฌู ุงูุฏูุนุฉ ุฃูุจุฑ ูู `1` ุฅุฐุง ููุช ุชุฑูุฏ ุชูููุฏ ุตูุฑ ูุชุนุฏุฏุฉ (ููู ุดุฑูุญุฉ) ูู ููุณ ุงูููุช.

ุจุนุฏ ุฐููุ ูู ุจุฅูุดุงุก ูููุฏ ุฃุฑูุงู ุนุดูุงุฆูุฉ ูุชูุฑูุฑู ุฅูู ุฏุงูุฉ ุงูุชูููุฏ. ูุฐู ูู ุงูุฅุฌุฑุงุกุงุช ุงูููุงุณูุฉ ูู Flaxุ ูุงูุชู ุชุชุนุงูู ูุน ุงูุฃุฑูุงู ุงูุนุดูุงุฆูุฉ ุจุฌุฏูุฉ ูุตุฑุงูุฉ. ูู ุงููุชููุน ุฃู ุชุชููู ุฌููุน ุงูุฏุงูุงุช ุงูุชู ุชุชุนุงูู ูุน ุงูุฃุฑูุงู ุงูุนุดูุงุฆูุฉ ูููุฏูุง ูุถูุงู ุฅููุงููุฉ ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌุ ุญุชู ุนูุฏ ุงูุชุฏุฑูุจ ุนุจุฑ ุฃุฌูุฒุฉ ููุฒุนุฉ ูุชุนุฏุฏุฉ.

ุชุณุชุฎุฏู ุฏุงูุฉ ุงููุณุงุนุฏุฉ ุฃุฏูุงู ุจุฐุฑุฉ ูุชููุฆุฉ ูููุฏ ุฑูู ุนุดูุงุฆู. ุทุงููุง ุฃูู ุชุณุชุฎุฏู ููุณ ุงูุจุฐุฑุฉุ ูุณุชุญุตู ุนูู ููุณ ุงููุชุงุฆุฌ ุจุงูุถุจุท. ูุง ุชุชุฑุฏุฏ ูู ุงุณุชุฎุฏุงู ุจุฐูุฑ ูุฎุชููุฉ ุนูุฏ ุงุณุชูุดุงู ุงููุชุงุฆุฌ ูุงุญููุง ูู ุงูุฏููู.

```python
def create_key(seed=0):
    return jax.random.PRNGKey(seed)
```

ูุชู ุชูุณูู ุฏุงูุฉ ุงููุณุงุนุฏุฉุ ุฃู `rng`ุ 8 ูุฑุงุช ุจุญูุซ ูุชููู ูู ุฌูุงุฒ ูููุฏูุง ูุฎุชูููุง ูููุดุฆ ุตูุฑุฉ ูุฎุชููุฉ.

```python
rng = create_key(0)
rng = jax.random.split(rng, jax.device_count())
```

ููุงุณุชูุงุฏุฉ ูู ุงูุณุฑุนุฉ ุงููุญุณูุฉ ูู JAX ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ TensorFlow (TPU)ุ ูู ุจุชูุฑูุฑ `jit=True` ุฅูู ุฎุท ุงูุฃูุงุจูุจ ูุชุฌููุน ุฑูุฒ JAX ุฅูู ุชูุซูู ูุนุงู ูุถูุงู ุชุดุบูู ุงููููุฐุฌ ุจุงูุชูุงุฒู ุนุจุฑ ุงูุฃุฌูุฒุฉ ุงูุซูุงููุฉ.

<Tip warning={true}>
ูุฌุจ ุงูุชุฃูุฏ ูู ุฃู ุฌููุน ูุฏุฎูุงุชู ููุง ููุณ ุงูุดูู ูู ุงูุงุณุชุฏุนุงุกุงุช ุงููุงุญูุฉุ ูุฅูุง ูุณูุชุนูู ุนูู JAX ุฅุนุงุฏุฉ ุชุฌููุน ุงูุฑูุฒุ ููู ุฃุจุทุฃ.
</Tip>

ุชุณุชุบุฑู ุนูููุฉ ุงูุงุณุชุฏูุงู ุงูุฃููู ููุชูุง ุฃุทูู ูุฃููุง ุชุญุชุงุฌ ุฅูู ุชุฌููุน ุงูุฑูุฒุ ูููู ุงูุงุณุชุฏุนุงุกุงุช ุงููุงุญูุฉ (ุญุชู ูุน ูุฏุฎูุงุช ูุฎุชููุฉ) ุชููู ุฃุณุฑุน ุจูุซูุฑ. ุนูู ุณุจูู ุงููุซุงูุ ุงุณุชุบุฑู ุงูุฃูุฑ ุฃูุซุฑ ูู ุฏูููุฉ ูุชุฌููุน ุนูู ูุญุฏุฉ ูุนุงูุฌุฉ TensorFlow (TPU) v2-8ุ ูููู ุจุนุฏ ุฐูู ูุณุชุบุฑู ุญูุงูู **7 ุซูุงูู** ูู ุนูููุฉ ุงุณุชุฏูุงู ูุณุชูุจููุฉ!

```py
%%time
images = pipeline(prompt_ids, p_params, rng, jit=True)[0]

# ุฃููุงุช ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ: ุงููุณุชุฎุฏู 56.2 ุซุงููุฉุ ุงููุธุงู: 42.5 ุซุงููุฉุ ุงูุฅุฌูุงูู: 1 ุฏูููุฉ 38 ุซุงููุฉ
# ุงูููุช ุงููุนูู: 1 ุฏูููุฉ 29 ุซุงููุฉ
```

ูููู ููุดูู ุงููุตูููุฉ ุงูููุฑุฌุนุฉ ุดูู `(8ุ 1ุ 512ุ 512ุ 3)` ูุงูุฐู ูุฌุจ ุฅุนุงุฏุฉ ุชุดูููู ูุฅุฒุงูุฉ ุงูุจุนุฏ ุงูุซุงูู ูุงูุญุตูู ุนูู 8 ุตูุฑ ุจุญุฌู `512 ร 512 ร 3`. ุจุนุฏ ุฐููุ ููููู ุงุณุชุฎุฏุงู ุฏุงูุฉ [`~utils.numpy_to_pil`] ูุชุญููู ุงููุตูููุงุช ุฅูู ุตูุฑ.

```python
from diffusers.utils import make_image_grid

images = images.reshape((images.shape[0] * images.shape[1],) + images.shape[-3:])
images = pipeline.numpy_to_pil(images)
make_image_grid(images, rows=2, cols=4)
```

![img](https://huggingface.co/datasets/YiYiXu/test-doc-assets/resolve/main/stable_diffusion_jax_how_to_cell_38_output_0.jpeg)

## ุงุณุชุฎุฏุงู ูุญูุฒุงุช ูุฎุชููุฉ

ุฃูุช ูุณุช ูุถุทุฑูุง ุจุงูุถุฑูุฑุฉ ุฅูู ุงุณุชุฎุฏุงู ููุณ ุงููุญูุฒ ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ. ุนูู ุณุจูู ุงููุซุงูุ ูุชูููุฏ 8 ูุญูุฒุงุช ูุฎุชููุฉ:

```python
prompts = [
    "ูุงุจุฑุงุฏูุฑ ุนูู ุทุฑููุฉ ููููุณุงู"ุ
    "ุฑุณู ุณูุฌุงุจ ูุชุฒูุฌ ูู ูููููุฑู"ุ
    "HAL-9000 ุนูู ุทุฑููุฉ ูุงู ุฌูุฎ"ุ
    "ุชุงููุฒ ุณูููุฑ ุชุญุช ุงููุงุกุ ูุน ุงูุฃุณูุงู ูุฏูููู ูุณุจุญุงู ุญูููุง"ุ
    "ููุญุฉ ุฌุฏุงุฑูุฉ ุฑููุงููุฉ ูุฏููุฉ ุชุธูุฑ ุฑุฌูุงู ูุนูู ุนูู ุฌูุงุฒ ููุจููุชุฑ ูุญููู"ุ
    "ุตูุฑุฉ ููุฑุจุฉ ูุดุงุจุฉ ุณูุฏุงุก ุนูู ุฎูููุฉ ุญุถุฑูุฉุ ุจุฌูุฏุฉ ุนุงููุฉุ ุจูููู"ุ
    "ูุฑุณู ุนูู ุดูู ุฃูููุงุฏู"ุ
    "ููุฑุฌ ุฑุงุฆุฏ ูุถุงุก ูู ุงููุถุงุกุ ูุน ุงูุฃุฑุถ ูู ุงูุฎูููุฉ"ุ
]

prompt_ids = pipeline.prepare_inputs(prompts)
prompt_ids = shard(prompt_ids)

images = pipeline(prompt_ids, p_params, rng, jit=True).images
images = images.reshape((images.shape[0] * images.shape[1],) + images.shape[-3:])
images = pipeline.numpy_to_pil(images)

make_image_grid(images, 2, 4)
```

![img](https://huggingface.co/datasets/YiYiXu/test-doc-assets/resolve/main/stable_diffusion_jax_how_to_cell_43_output_0.jpeg)
## ููู ุชุนูู ุงูููุงุฒุงุฉุ

ุชููู ุฎุทูุฉ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู ๐ค Diffusers ุชููุงุฆููุง ุจุชุฌููุน ุงููููุฐุฌ ูุชุดุบููู ุจุดูู ูุชูุงุฒู ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ ุงููุชุงุญุฉ. ุฏุนูุง ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ููููุฉ ุนูู ูุฐู ุงูุนูููุฉ.

ูููู ุฅุฌุฑุงุก ุงูููุงุฒุงุฉ ูู JAX ุจุนุฏุฉ ุทุฑู. ุฃุณูููุง ูู ุงุณุชุฎุฏุงู ุฏุงูุฉ [`jax.pmap`](https://jax.readthedocs.io/en/latest/_autosummary/jax.pmap.html) ูุชุญููู ููุงุฒุงุฉ ุจุฑูุงูุฌ ูุงุญุฏ ูุจูุงูุงุช ูุชุนุฏุฏุฉ (SPMD). ููุฐุง ูุนูู ุชุดุบูู ุนุฏุฉ ูุณุฎ ูู ููุณ ุงูููุฏุ ููู ูููุง ูุฏุฎูุงุช ุจูุงูุงุช ูุฎุชููุฉ. ูููุงู ุทุฑู ุฃูุซุฑ ุชูุฏููุง ููููุฉุ ูููููู ุงูุงุทูุงุน ุนูู ูุซุงุฆู JAX [documentation](https://jax.readthedocs.io/en/latest/index.html) ูุงุณุชูุดุงู ูุฐุง ุงูููุถูุน ุจูุฒูุฏ ูู ุงูุชูุตูู ุฅุฐุง ููุช ููุชููุง!

ุชููู `jax.pmap` ุจุนูููู:

1. ุชุฌููุน (ุฃู "jit") ุงูููุฏุ ููู ูุดุงุจู ูู `jax.jit()`. ูุง ูุญุฏุซ ูุฐุง ุนูุฏ ุงุณุชุฏุนุงุก `pmap`ุ ูููู ููุท ูู ุงููุฑุฉ ุงูุฃููู ุงูุชู ูุชู ูููุง ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุงูููุนุงูุฌุฉ.
2. ุงูุชุฃูุฏ ูู ุฃู ุงูููุฏ ุงููุฌูุน ูุนูู ุจุดูู ูุชูุงุฒู ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ ุงููุชุงุญุฉ.

ูููุชูุถูุญุ ูู ุจุงุณุชุฏุนุงุก `pmap` ุนูู ุทุฑููุฉ `_generate` ูู ุฎุท ุฃูุงุจูุจ ุงููุนุงูุฌุฉ (ูุฐู ุทุฑููุฉ ุฎุงุตุฉ ุชููุฏ ุงูุตูุฑ ููุฏ ูุชู ุฅุนุงุฏุฉ ุชุณููุชูุง ุฃู ุฅุฒุงูุชูุง ูู ุงูุฅุตุฏุงุฑุงุช ุงููุณุชูุจููุฉ ูู ๐ค Diffusers):

```python
p_generate = pmap(pipeline._generate)
```

ุจุนุฏ ุงุณุชุฏุนุงุก `pmap`ุ ุณุชููู ุงูุฏุงูุฉ ุงูููุนุฏุฉ `p_generate` ุจูุง ููู:

1. ุฅูุดุงุก ูุณุฎุฉ ูู ุงูุฏุงูุฉ ุงูุฃุณุงุณูุฉุ `pipeline._generate`ุ ุนูู ูู ุฌูุงุฒ.
2. ุฅุฑุณุงู ุฌุฒุก ูุฎุชูู ูู ูุณุงุฆุท ุงูุฅุฏุฎุงู ุฅูู ูู ุฌูุงุฒ (ูุฐุง ูู ุณุจุจ ุถุฑูุฑุฉ ุงุณุชุฏุนุงุก ุฏุงูุฉ *shard*). ูู ูุฐู ุงูุญุงูุฉุ ูุชู ุชูุณูู ุงููุตูููุฉ `prompt_ids` ุฐุงุช ุงูุดูู `(8, 1, 77, 768)` ุฅูู 8 ุฃุฌุฒุงุกุ ูุชุชููู ูู ูุณุฎุฉ ูู `_generate` ุฅุฏุฎุงููุง ุจุดูู `(1, 77, 768)`.

ุฃูู ุดูุก ูุฌุจ ุงูุงูุชุจุงู ุฅููู ููุง ูู ุญุฌู ุงูุฏูุนุฉ (1 ูู ูุฐุง ุงููุซุงู)ุ ูุฃุจุนุงุฏ ุงูุฅุฏุฎุงู ุงูุชู ููุง ูุนูู ุจุงููุณุจุฉ ูุฑูุฒู. ูุง ูุชุนูู ุนููู ุชุบููุฑ ุฃู ุดูุก ุขุฎุฑ ูุฌุนู ุงูููุฏ ูุนูู ุจุดูู ูุชูุงุฒู.

ูุณุชุบุฑู ุงูุงุณุชุฏุนุงุก ุงูุฃูู ูุฎุท ุงูุฃูุงุจูุจ ููุชูุง ุฃุทููุ ูููู ุงูุงุณุชุฏุนุงุกุงุช ุงููุงุญูุฉ ุชููู ุฃุณุฑุน ุจูุซูุฑ. ูุชูุณุชุฎุฏู ุฏุงูุฉ `block_until_ready` ูููุงุณ ููุช ุงูุงุณุชูุชุงุฌ ุจุดูู ุตุญูุญ ูุฃู JAX ูุณุชุฎุฏู ุงูุชูุฒูุน ุบูุฑ ุงููุชุฒุงูู ููุนูุฏ ุงูุชุญูู ุฅูู ุญููุฉ Python ูู ุฃูุฑุจ ููุช ูููู. ูุง ุชุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ุฐูู ูู ููุฏูุ ูุญุฏุซ ุงูุญุธุฑ ุชููุงุฆููุง ุนูุฏูุง ุชุฑูุฏ ุงุณุชุฎุฏุงู ูุชูุฌุฉ ุญุณุงุจ ูู ูุชู ุชุญูููู ุจุนุฏ.

```py
%%time
images = p_generate(prompt_ids, p_params, rng)
images = images.block_until_ready()

# CPU times: user 1min 15s, sys: 18.2 s, total: 1min 34s
# Wall time: 1min 15s
```

ุชุญูู ูู ุฃุจุนุงุฏ ุงูุตูุฑุฉ ููุชุฃูุฏ ูู ุฃููุง ุตุญูุญุฉ:

```python
images.shape
# (8, 1, 512, 512, 3)
```

## ุงููุตุงุฏุฑ

ููุนุฑูุฉ ุงููุฒูุฏ ุนู ููููุฉ ุนูู JAX ูุน Stable Diffusionุ ูุฏ ุชููู ููุชููุง ุจูุฑุงุกุฉ ูุง ููู:

* [ุชุณุฑูุน ุงุณุชูุชุงุฌ Stable Diffusion XL ุจุงุณุชุฎุฏุงู JAX ุนูู Cloud TPU v5e](https://hf.co/blog/sdxl_jax)